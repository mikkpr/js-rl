!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=41)}([function(t,e,n){"use strict";const r=2.3283064365386963e-10;class i{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*r,t=69069*t+1>>>0,this._s1=t*r,t=69069*t+1>>>0,this._s2=t*r,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*r;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let n=Math.max(t,e),r=Math.min(t,e);return Math.floor(this.getUniform()*(n-r+1))+r}getNormal(t=0,e=1){let n,r,i;do{n=2*this.getUniform()-1,r=2*this.getUniform()-1,i=n*n+r*r}while(i>1||0==i);return t+n*Math.sqrt(-2*Math.log(i)/i)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],n=t.slice();for(;n.length;){let t=n.indexOf(this.getItem(n));e.push(n.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let n in t)e+=t[n];let n,r=this.getUniform()*e,i=0;for(n in t)if(i+=t[n],r<i)return n;return n}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new i).setState(this.getState())}}e.a=(new i).setSeed(Date.now())},function(t,e,n){t.exports=n(22)},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e,n){var r;n(40),void 0===(r=function(){var t,e="undefined"!=typeof navigator&&~navigator.userAgent.indexOf("Mac OS X"),n=["shiftKey","ctrlKey","altKey","metaKey"],r={shift:"shift",ctrl:"ctrl",control:"ctrl",alt:"alt",option:"alt",win:"meta",cmd:"meta",super:"meta",meta:"meta",defmod:e?"meta":"ctrl"},i=["shift","ctrl","alt","meta"],o=[16,17,18,91],s={backspace:8,tab:9,enter:13,return:13,pause:19,caps:20,capslock:20,escape:27,esc:27,space:32,pgup:33,pageup:33,pgdown:34,pagedown:34,end:35,home:36,ins:45,insert:45,del:46,delete:46,left:37,up:38,right:39,down:40,"*":106,"+":107,plus:107,minus:109,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(t=0;t<10;t++)s["num-"+t]=t+95;for(t=0;t<10;t++)s[t.toString()]=t+48;for(t=1;t<25;t++)s["f"+t]=t+111;for(t=65;t<91;t++)s[String.fromCharCode(t).toLowerCase()]=t;var a={};for(var c in s){var l=s[c];(!a[l]||a[l].length<c.length)&&(a[l]=c)}var u="",h={};function f(t){var e,n=t.split(/-(?!$)/),i=n[n.length-1],o={code:s[i]};if(!o.code)throw'Unknown key "'+i+'" in keystring "'+t+'"';for(var a=0;a<n.length-1;a++){if(i=n[a],!(e=r[i]))throw'Unknown modifier "'+i+'" in keystring "'+t+'"';o[e]=!0}return o}function p(t){for(var e="",n=0;n<i.length;n++)t[i[n]]&&(e+=i[n]+"-");return e+=a[t.code]}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(r&&(t=t[r]),!t)break}return t}var _=[];function g(t,e,n){for(var r=t.split("."),i=h,o=0,s=(r=r.concat(e)).length;o<s;o++){var a=r[o];if(a&&(i=i[a]||(i[a]={}),n&&n._keymage.preventDefault&&(i.preventDefault=!0),o===s-1))return i.handlers||(i.handlers=[])}}function m(t,e,n){g(t,e,n).push(n)}function v(t,e,n){var r=g(t,e),i=r.indexOf(n);~i&&r.splice(i,1)}function y(t,e,n,r){if(void 0===e&&void 0===n)return function(e,n){return b(t,e,n)};"function"==typeof e&&(r=n,n=e,e=t,t="");var i=function(t){for(var e=[],n=t.split(" "),r=0;r<n.length;r++){var i=f(n[r]);i=p(i),e.push(i)}return e.original=t,e}(e);return[t,i,n,r]}function b(t,e,n,r){var i=y(t,e,n,r);return n=i[2],r=i[3],n._keymage=r||{},n._keymage.original=e,m.apply(null,i),function(){v.apply(null,i)}}return b.unbind=function(t,e,n){var r=y(t,e,n);v.apply(null,r)},b.parse=f,b.stringify=p,b.bindings=h,b.setScope=function(t){u=t||""},b.getScope=function(){return u},b.pushScope=function(t){return u=(u?u+".":"")+t},b.popScope=function(t){var e;return t?(u=u.replace(new RegExp("(^|\\.)"+t+"(\\.|$).*"),""),t):(e=u.lastIndexOf("."),t=u.slice(e+1),u=-1==e?"":u.slice(0,e),t)},b.version="1.1.3",window.addEventListener("keydown",(function(t){if(!~o.indexOf(t.keyCode)){var e=_.slice();e.push(function(t){for(var e={code:t.keyCode},r=0;r<n.length;r++){var i=n[r];t[i]&&(e[i.slice(0,i.length-3)]=!0)}return p(e)}(t));for(var r,i,s,a=u.split("."),c=a.length;c>=0;c--)if(i=d(h,a.slice(0,c))){r=!0;for(var l=0;l<e.length;l++){if(!i[s=e[l]]){r=!1;break}i=i[s]}if(r)break}var f=a.slice(0,c).join("."),g=i.preventDefault;if(r&&!i.handlers)return _=e,void(g&&t.preventDefault());if(r)for(c=0;c<i.handlers.length;c++){var m=i.handlers[c],v=m._keymage;(!1===m.call(v.context,t,{shortcut:v.original,scope:u,definitionScope:f})||g)&&t.preventDefault()}_=[]}}),!1),b}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){"use strict";function r(t,e){return(t%e+e)%e}function i(t,e=0,n=1){return t<e?e:t>n?n:t}function o(t){return t.charAt(0).toUpperCase()+t.substring(1)}function s(t,...e){let n=s.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(r,i,s,a){if("%"==t.charAt(a-1))return r.substring(1);if(!e.length)return r;let c=e[0],l=(i||s).split(","),u=l.shift()||"",h=n[u.toLowerCase()];if(!h)return r;c=e.shift();let f=c[h].apply(c,l),p=u.charAt(0);return p!=p.toLowerCase()&&(f=o(f)),f}))}n.r(e),n.d(e,"mod",(function(){return r})),n.d(e,"clamp",(function(){return i})),n.d(e,"capitalize",(function(){return o})),n.d(e,"format",(function(){return s})),s.map={s:"toString"}},function(t,e,n){var r=n(25),i=n(26),o=n(16),s=n(27);t.exports=function(t){return r(t)||i(t)||o(t)||s()}},function(t,e,n){"use strict";n.r(e),n.d(e,"fromString",(function(){return o})),n.d(e,"add",(function(){return s})),n.d(e,"add_",(function(){return a})),n.d(e,"multiply",(function(){return c})),n.d(e,"multiply_",(function(){return l})),n.d(e,"interpolate",(function(){return u})),n.d(e,"lerp",(function(){return h})),n.d(e,"interpolateHSL",(function(){return f})),n.d(e,"lerpHSL",(function(){return p})),n.d(e,"randomize",(function(){return d})),n.d(e,"rgb2hsl",(function(){return _})),n.d(e,"hsl2rgb",(function(){return m})),n.d(e,"toRGB",(function(){return v})),n.d(e,"toHex",(function(){return y}));var r=n(4),i=n(0);function o(t){let e,n;if(t in b)e=b[t];else{if("#"==t.charAt(0)){let n=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==n.length)e=n.map(t=>17*t);else{for(let t=0;t<3;t++)n[t+1]+=16*n[t],n.splice(t,1);e=n}}else e=(n=t.match(/rgb\(([0-9, ]+)\)/i))?n[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];b[t]=e}return e.slice()}function s(t,...e){let n=t.slice();for(let t=0;t<3;t++)for(let r=0;r<e.length;r++)n[t]+=e[r][t];return n}function a(t,...e){for(let n=0;n<3;n++)for(let r=0;r<e.length;r++)t[n]+=e[r][n];return t}function c(t,...e){let n=t.slice();for(let t=0;t<3;t++){for(let r=0;r<e.length;r++)n[t]*=e[r][t]/255;n[t]=Math.round(n[t])}return n}function l(t,...e){for(let n=0;n<3;n++){for(let r=0;r<e.length;r++)t[n]*=e[r][n]/255;t[n]=Math.round(t[n])}return t}function u(t,e,n=.5){let r=t.slice();for(let i=0;i<3;i++)r[i]=Math.round(r[i]+n*(e[i]-t[i]));return r}const h=u;function f(t,e,n=.5){let r=_(t),i=_(e);for(let t=0;t<3;t++)r[t]+=n*(i[t]-r[t]);return m(r)}const p=f;function d(t,e){e instanceof Array||(e=Math.round(i.a.getNormal(0,e)));let n=t.slice();for(let t=0;t<3;t++)n[t]+=e instanceof Array?Math.round(i.a.getNormal(0,e[t])):e;return n}function _(t){let e,n=t[0]/255,r=t[1]/255,i=t[2]/255,o=Math.max(n,r,i),s=Math.min(n,r,i),a=0,c=(o+s)/2;if(o==s)e=0;else{let t=o-s;switch(e=c>.5?t/(2-o-s):t/(o+s),o){case n:a=(r-i)/t+(r<i?6:0);break;case r:a=(i-n)/t+2;break;case i:a=(n-r)/t+4}a/=6}return[a,e,c]}function g(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function m(t){let e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];{let n=t[1],r=e<.5?e*(1+n):e+n-e*n,i=2*e-r,o=g(i,r,t[0]+1/3),s=g(i,r,t[0]),a=g(i,r,t[0]-1/3);return[Math.round(255*o),Math.round(255*s),Math.round(255*a)]}}function v(t){return`rgb(${t.map(t=>Object(r.clamp)(t,0,255)).join(",")})`}function y(t){return"#"+t.map(t=>Object(r.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}const b={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));class r{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e){function n(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var s=t.apply(e,r);function a(t){n(s,i,o,a,c,"next",t)}function c(t){n(s,i,o,a,c,"throw",t)}a(void 0)}))}}},function(t,e,n){var r=n(37),i=n(38),o=n(16),s=n(39);t.exports=function(t,e){return r(t)||i(t,e)||o(t,e)||s()}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return s}));var r=n(7),i=n(6);function o(t){let e=i.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class s extends r.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],n=this.computeSize();this._offset=n.map((t,n)=>Math.floor((t-e[n])/2))}clear(){t.stdout.write(`[0;48;5;${o(this._options.bg)}m[2J`)}draw(e,n){let[r,i,s,a,c]=e,l=this._offset[0]+r,u=this._offset[1]+i,h=this.computeSize();if(l<0||l>=h[0])return;if(u<0||u>=h[1])return;if(l===this._cursor[0]&&u===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(l,u)),this._cursor[0]=l,this._cursor[1]=u),n&&(s||(s=" ")),!s)return;let f=function(t,e){return`[0;38;5;${o(t)};48;5;${o(e)}m`}(a,c);f!==this._lastColor&&(t.stdout.write(f),this._lastColor=f);let p=[].concat(s);t.stdout.write(p[0]),this._cursor[0]++,this._cursor[0]>=h[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,n(23))},function(t,e,n){"use strict";(function(t,r){var i,o=n(20);i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:r;var s=Object(o.a)(i);e.a=s}).call(this,n(11),n(24)(t))},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},function(t,e,n){var r=n(15);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},function(t,e,n){var r=n(30),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},function(t,e,n){var r=n(17).Symbol;t.exports=r},function(t,e,n){(function(t){!function(e){"use strict";function n(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function r(t,e){Object.defineProperty(this,"kind",{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,"path",{value:e,enumerable:!0})}function i(t,e,n){i.super_.call(this,"E",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function o(t,e){o.super_.call(this,"N",t),Object.defineProperty(this,"rhs",{value:e,enumerable:!0})}function s(t,e){s.super_.call(this,"D",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0})}function a(t,e,n){a.super_.call(this,"A",t),Object.defineProperty(this,"index",{value:e,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function c(t,e,n){var r=t.slice((n||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,r),t}function l(t){var e=void 0===t?"undefined":E(t);return"object"!==e?e:t===Math?"math":null===t?"null":Array.isArray(t)?"array":"[object Date]"===Object.prototype.toString.call(t)?"date":"function"==typeof t.toString&&/^\/.*\//.test(t.toString())?"regexp":"object"}function u(t,e,n,r,h,f,p){p=p||[];var d=(h=h||[]).slice(0);if(void 0!==f){if(r){if("function"==typeof r&&r(d,f))return;if("object"===(void 0===r?"undefined":E(r))){if(r.prefilter&&r.prefilter(d,f))return;if(r.normalize){var _=r.normalize(d,f,t,e);_&&(t=_[0],e=_[1])}}}d.push(f)}"regexp"===l(t)&&"regexp"===l(e)&&(t=t.toString(),e=e.toString());var g=void 0===t?"undefined":E(t),m=void 0===e?"undefined":E(e),v="undefined"!==g||p&&p[p.length-1].lhs&&p[p.length-1].lhs.hasOwnProperty(f),y="undefined"!==m||p&&p[p.length-1].rhs&&p[p.length-1].rhs.hasOwnProperty(f);if(!v&&y)n(new o(d,e));else if(!y&&v)n(new s(d,t));else if(l(t)!==l(e))n(new i(d,t,e));else if("date"===l(t)&&t-e!=0)n(new i(d,t,e));else if("object"===g&&null!==t&&null!==e)if(p.filter((function(e){return e.lhs===t})).length)t!==e&&n(new i(d,t,e));else{if(p.push({lhs:t,rhs:e}),Array.isArray(t)){var b;for(t.length,b=0;b<t.length;b++)b>=e.length?n(new a(d,b,new s(void 0,t[b]))):u(t[b],e[b],n,r,d,b,p);for(;b<e.length;)n(new a(d,b,new o(void 0,e[b++])))}else{var w=Object.keys(t),x=Object.keys(e);w.forEach((function(i,o){var s=x.indexOf(i);s>=0?(u(t[i],e[i],n,r,d,i,p),x=c(x,s)):u(t[i],void 0,n,r,d,i,p)})),x.forEach((function(t){u(void 0,e[t],n,r,d,t,p)}))}p.length=p.length-1}else t!==e&&("number"===g&&isNaN(t)&&isNaN(e)||n(new i(d,t,e)))}function h(t,e,n,r){return r=r||[],u(t,e,(function(t){t&&r.push(t)}),n),r.length?r:void 0}function f(t,e,n){if(t&&e&&n&&n.kind){for(var r=t,i=-1,o=n.path?n.path.length-1:0;++i<o;)void 0===r[n.path[i]]&&(r[n.path[i]]="number"==typeof n.path[i]?[]:{}),r=r[n.path[i]];switch(n.kind){case"A":!function t(e,n,r){if(r.path&&r.path.length){var i,o=e[n],s=r.path.length-1;for(i=0;i<s;i++)o=o[r.path[i]];switch(r.kind){case"A":t(o[r.path[i]],r.index,r.item);break;case"D":delete o[r.path[i]];break;case"E":case"N":o[r.path[i]]=r.rhs}}else switch(r.kind){case"A":t(e[n],r.index,r.item);break;case"D":e=c(e,n);break;case"E":case"N":e[n]=r.rhs}return e}(n.path?r[n.path[i]]:r,n.index,n.item);break;case"D":delete r[n.path[i]];break;case"E":case"N":r[n.path[i]]=n.rhs}}}function p(t){return"color: "+T[t].color+"; font-weight: bold"}function d(t,e,n,r){var i=h(t,e);try{r?n.groupCollapsed("diff"):n.group("diff")}catch(t){n.log("diff")}i?i.forEach((function(t){var e=t.kind,r=function(t){var e=t.kind,n=t.path,r=t.lhs,i=t.rhs,o=t.index,s=t.item;switch(e){case"E":return[n.join("."),r,"→",i];case"N":return[n.join("."),i];case"D":return[n.join(".")];case"A":return[n.join(".")+"["+o+"]",s];default:return[]}}(t);n.log.apply(n,["%c "+T[e].text,p(e)].concat(O(r)))})):n.log("—— no diff ——");try{n.groupEnd()}catch(t){n.log("—— diff end —— ")}}function _(t,e,n,r){switch(void 0===t?"undefined":E(t)){case"object":return"function"==typeof t[r]?t[r].apply(t,O(n)):t[r];case"function":return t(e);default:return t}}function g(t,e){var n=e.logger,r=e.actionTransformer,i=e.titleFormatter,o=void 0===i?function(t){var e=t.timestamp,n=t.duration;return function(t,r,i){var o=["action"];return o.push("%c"+String(t.type)),e&&o.push("%c@ "+r),n&&o.push("%c(in "+i.toFixed(2)+" ms)"),o.join(" ")}}(e):i,s=e.collapsed,a=e.colors,c=e.level,l=e.diff,u=void 0===e.titleFormatter;t.forEach((function(i,h){var f=i.started,p=i.startedTime,g=i.action,m=i.prevState,v=i.error,y=i.took,b=i.nextState,x=t[h+1];x&&(b=x.prevState,y=x.started-f);var E=r(g),O="function"==typeof s?s((function(){return b}),g,i):s,S=w(p),T=a.title?"color: "+a.title(E)+";":"",A=["color: gray; font-weight: lighter;"];A.push(T),e.timestamp&&A.push("color: gray; font-weight: lighter;"),e.duration&&A.push("color: gray; font-weight: lighter;");var k=o(E,S,y);try{O?a.title&&u?n.groupCollapsed.apply(n,["%c "+k].concat(A)):n.groupCollapsed(k):a.title&&u?n.group.apply(n,["%c "+k].concat(A)):n.group(k)}catch(t){n.log(k)}var P=_(c,E,[m],"prevState"),C=_(c,E,[E],"action"),M=_(c,E,[v,m],"error"),L=_(c,E,[b],"nextState");if(P)if(a.prevState){var R="color: "+a.prevState(m)+"; font-weight: bold";n[P]("%c prev state",R,m)}else n[P]("prev state",m);if(C)if(a.action){var j="color: "+a.action(E)+"; font-weight: bold";n[C]("%c action    ",j,E)}else n[C]("action    ",E);if(v&&M)if(a.error){var D="color: "+a.error(v,m)+"; font-weight: bold;";n[M]("%c error     ",D,v)}else n[M]("error     ",v);if(L)if(a.nextState){var K="color: "+a.nextState(b)+"; font-weight: bold";n[L]("%c next state",K,b)}else n[L]("next state",b);l&&d(m,b,n,O);try{n.groupEnd()}catch(t){n.log("—— log end ——")}}))}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},A,t),n=e.logger,r=e.stateTransformer,i=e.errorTransformer,o=e.predicate,s=e.logErrors,a=e.diffPredicate;if(void 0===n)return function(){return function(t){return function(e){return t(e)}}};if(t.getState&&t.dispatch)return console.error("[redux-logger] redux-logger not installed. Make sure to pass logger instance as middleware:\n// Logger with default options\nimport { logger } from 'redux-logger'\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n// Or you can create your own logger with custom options http://bit.ly/redux-logger-options\nimport createLogger from 'redux-logger'\nconst logger = createLogger({\n  // ...options\n});\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n"),function(){return function(t){return function(e){return t(e)}}};var c=[];return function(t){var n=t.getState;return function(t){return function(l){if("function"==typeof o&&!o(n,l))return t(l);var u={};c.push(u),u.started=x.now(),u.startedTime=new Date,u.prevState=r(n()),u.action=l;var h=void 0;if(s)try{h=t(l)}catch(t){u.error=i(t)}else h=t(l);u.took=x.now()-u.started,u.nextState=r(n());var f=e.diff&&"function"==typeof a?a(n,l):e.diff;if(g(c,Object.assign({},e,{diff:f})),c.length=0,u.error)throw u.error;return h}}}}var v,y,b=function(t,e){return function(t,e){return new Array(e+1).join(t)}("0",e-t.toString().length)+t},w=function(t){return b(t.getHours(),2)+":"+b(t.getMinutes(),2)+":"+b(t.getSeconds(),2)+"."+b(t.getMilliseconds(),3)},x="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance:Date,E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},S=[];v="object"===(void 0===t?"undefined":E(t))&&t?t:"undefined"!=typeof window?window:{},(y=v.DeepDiff)&&S.push((function(){void 0!==y&&v.DeepDiff===h&&(v.DeepDiff=y,y=void 0)})),n(i,r),n(o,r),n(s,r),n(a,r),Object.defineProperties(h,{diff:{value:h,enumerable:!0},observableDiff:{value:u,enumerable:!0},applyDiff:{value:function(t,e,n){t&&e&&u(t,e,(function(r){n&&!n(t,e,r)||f(t,e,r)}))},enumerable:!0},applyChange:{value:f,enumerable:!0},revertChange:{value:function(t,e,n){if(t&&e&&n&&n.kind){var r,i,o=t;for(i=n.path.length-1,r=0;r<i;r++)void 0===o[n.path[r]]&&(o[n.path[r]]={}),o=o[n.path[r]];switch(n.kind){case"A":!function t(e,n,r){if(r.path&&r.path.length){var i,o=e[n],s=r.path.length-1;for(i=0;i<s;i++)o=o[r.path[i]];switch(r.kind){case"A":t(o[r.path[i]],r.index,r.item);break;case"D":case"E":o[r.path[i]]=r.lhs;break;case"N":delete o[r.path[i]]}}else switch(r.kind){case"A":t(e[n],r.index,r.item);break;case"D":case"E":e[n]=r.lhs;break;case"N":e=c(e,n)}return e}(o[n.path[r]],n.index,n.item);break;case"D":case"E":o[n.path[r]]=n.lhs;break;case"N":delete o[n.path[r]]}}},enumerable:!0},isConflict:{value:function(){return void 0!==y},enumerable:!0},noConflict:{value:function(){return S&&(S.forEach((function(t){t()})),S=null),h},enumerable:!0}});var T={E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}},A={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(t){return t},actionTransformer:function(t){return t},errorTransformer:function(t){return t},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},k=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dispatch,n=t.getState;return"function"==typeof e||"function"==typeof n?m()({dispatch:e,getState:n}):void console.error("\n[redux-logger v3] BREAKING CHANGE\n[redux-logger v3] Since 3.0.0 redux-logger exports by default logger with default settings.\n[redux-logger v3] Change\n[redux-logger v3] import createLogger from 'redux-logger'\n[redux-logger v3] to\n[redux-logger v3] import { createLogger } from 'redux-logger'\n")};e.defaults=A,e.createLogger=m,e.logger=k,e.default=k,Object.defineProperty(e,"__esModule",{value:!0})}(e)}).call(this,n(11))},function(t,e,n){"use strict";function r(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}n.d(e,"a",(function(){return r}))},function(t,e,n){var r=n(28),i=n(12);t.exports=function(t,e,n){var o=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,s="trailing"in n?!!n.trailing:s),r(t,e,{leading:o,maxWait:e,trailing:s})}},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(t,e,n,r){var i=e&&e.prototype instanceof u?e:u,o=Object.create(i.prototype),s=new x(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return O()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=y(s,n);if(a){if(a===l)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,s),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=a;var l={};function u(){}function h(){}function f(){}var p={};p[i]=function(){return this};var d=Object.getPrototypeOf,_=d&&d(d(E([])));_&&_!==e&&n.call(_,i)&&(p=_);var g=f.prototype=u.prototype=Object.create(p);function m(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function v(t,e){var r;this._invoke=function(i,o){function s(){return new e((function(r,s){!function r(i,o,s,a){var l=c(t[i],t,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,s,a)}),(function(t){r("throw",t,s,a)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return r("throw",t,s,a)}))}a(l.arg)}(i,o,r,s)}))}return r=r?r.then(s,s):s()}}function y(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,y(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function E(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return h.prototype=g.constructor=f,f.constructor=h,f[s]=h.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(v.prototype),v.prototype[o]=function(){return this},t.AsyncIterator=v,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var s=new v(a(e,n,r,i),o);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},m(g),g[s]="Generator",g[i]=function(){return this},g.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=E,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),w(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var c,l=[],u=!1,h=-1;function f(){u&&c&&(u=!1,c.length?l=c.concat(l):h=-1,l.length&&p())}function p(){if(!u){var t=a(f);u=!0;for(var e=l.length;e;){for(c=l,l=[];++h<e;)c&&c[h].run();h=-1,e=l.length}c=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function _(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new d(t,e)),1!==l.length||u||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=_,i.addListener=_,i.once=_,i.off=_,i.removeListener=_,i.removeAllListeners=_,i.emit=_,i.prependListener=_,i.prependOnceListener=_,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){var r=n(15);t.exports=function(t){if(Array.isArray(t))return r(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){var r=n(12),i=n(29),o=n(31),s=Math.max,a=Math.min;t.exports=function(t,e,n){var c,l,u,h,f,p,d=0,_=!1,g=!1,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function v(e){var n=c,r=l;return c=l=void 0,d=e,h=t.apply(r,n)}function y(t){return d=t,f=setTimeout(w,e),_?v(t):h}function b(t){var n=t-p;return void 0===p||n>=e||n<0||g&&t-d>=u}function w(){var t=i();if(b(t))return x(t);f=setTimeout(w,function(t){var n=e-(t-p);return g?a(n,u-(t-d)):n}(t))}function x(t){return f=void 0,m&&c?v(t):(c=l=void 0,h)}function E(){var t=i(),n=b(t);if(c=arguments,l=this,p=t,n){if(void 0===f)return y(p);if(g)return clearTimeout(f),f=setTimeout(w,e),v(p)}return void 0===f&&(f=setTimeout(w,e)),h}return e=o(e)||0,r(n)&&(_=!!n.leading,u=(g="maxWait"in n)?s(o(n.maxWait)||0,e):u,m="trailing"in n?!!n.trailing:m),E.cancel=function(){void 0!==f&&clearTimeout(f),d=0,c=p=l=f=void 0},E.flush=function(){return void 0===f?h:x(i())},E}},function(t,e,n){var r=n(17);t.exports=function(){return r.Date.now()}},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(11))},function(t,e,n){var r=n(12),i=n(32),o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(i(t))return NaN;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var n=a.test(t);return n||c.test(t)?l(t.slice(2),n?2:8):s.test(t)?NaN:+t}},function(t,e,n){var r=n(33),i=n(36);t.exports=function(t){return"symbol"==typeof t||i(t)&&"[object Symbol]"==r(t)}},function(t,e,n){var r=n(18),i=n(34),o=n(35),s=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?i(t):o(t)}},function(t,e,n){var r=n(18),i=Object.prototype,o=i.hasOwnProperty,s=i.toString,a=r?r.toStringTag:void 0;t.exports=function(t){var e=o.call(t,a),n=t[a];try{t[a]=void 0;var r=!0}catch(t){}var i=s.call(t);return r&&(e?t[a]=n:delete t[a]),i}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e,n){"use strict";n.r(e),n.d(e,"WIDTH",(function(){return Nr})),n.d(e,"HEIGHT",(function(){return Ir})),n.d(e,"display",(function(){return Ur}));var r={};n.r(r),n.d(r,"TYPE_TEXT",(function(){return A})),n.d(r,"TYPE_NEWLINE",(function(){return k})),n.d(r,"TYPE_FG",(function(){return P})),n.d(r,"TYPE_BG",(function(){return C})),n.d(r,"measure",(function(){return M})),n.d(r,"tokenize",(function(){return L}));var i={};n.r(i),n.d(i,"RNG",(function(){return h.a})),n.d(i,"Display",(function(){return U})),n.d(i,"StringGenerator",(function(){return F})),n.d(i,"EventQueue",(function(){return W})),n.d(i,"Scheduler",(function(){return z})),n.d(i,"FOV",(function(){return G})),n.d(i,"Map",(function(){return nt})),n.d(i,"Noise",(function(){return ot})),n.d(i,"Path",(function(){return at})),n.d(i,"Engine",(function(){return ct})),n.d(i,"Lighting",(function(){return lt})),n.d(i,"DEFAULT_WIDTH",(function(){return j})),n.d(i,"DEFAULT_HEIGHT",(function(){return D})),n.d(i,"DIRS",(function(){return K})),n.d(i,"KEYS",(function(){return V})),n.d(i,"Util",(function(){return ut})),n.d(i,"Color",(function(){return ht})),n.d(i,"Text",(function(){return ft}));var o=n(2),s=n.n(o),a=n(1),c=n.n(a),l=n(9),u=n.n(l),h=n(0),f=n(7);class p extends f.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?t.fontStyle+" ":""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let n=this._ctx.canvas,r=n.getBoundingClientRect();return t-=r.left,e-=r.top,t*=n.width/r.width,e*=n.height/r.height,t<0||e<0||t>=n.width||e>=n.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var d=n(4);class _ extends p{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[n,r,i,o,s]=t,a=[(n+1)*this._spacingX,r*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._ctx.fillStyle=s,this._fill(a[0],a[1])),!i)return;this._ctx.fillStyle=o;let c=[].concat(i);for(let t=0;t<c.length;t++)this._ctx.fillText(c[t],a[0],Math.ceil(a[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,r=e/(2+1.5*(this._options.height-1)),i=Math.min(n,r),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let a=s/100;i=Math.floor(i)+1;let c=2*i/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(c)-1}_normalizedEventToPosition(t,e){let n;this._options.transpose?(t+=e,t-=e=t-e,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let r=n/this._options.height;return e=Math.floor(e/r),Object(d.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let n=this._hexSize,r=this._options.border;const i=this._ctx;i.beginPath(),this._options.transpose?(i.moveTo(t-n+r,e),i.lineTo(t-n/2+r,e+this._spacingX-r),i.lineTo(t+n/2-r,e+this._spacingX-r),i.lineTo(t+n-r,e),i.lineTo(t+n/2-r,e-this._spacingX+r),i.lineTo(t-n/2+r,e-this._spacingX+r),i.lineTo(t-n+r,e)):(i.moveTo(t,e-n+r),i.lineTo(t+this._spacingX-r,e-n/2+r),i.lineTo(t+this._spacingX-r,e+n/2-r),i.lineTo(t,e+n-r),i.lineTo(t-this._spacingX+r,e+n/2-r),i.lineTo(t-this._spacingX+r,e-n/2+r),i.lineTo(t,e-n+r)),i.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let n,r;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(n="height",r="width"):(n="width",r="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[r]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class g extends p{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,e){g.cache?this._drawWithCache(t):this._drawNoCache(t,e)}_drawWithCache(t){let e,[n,r,i,o,s]=t,a=""+i+o+s;if(a in this._canvasCache)e=this._canvasCache[a];else{let t=this._options.border;e=document.createElement("canvas");let n=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,n.fillStyle=s,n.fillRect(t,t,e.width-t,e.height-t),i){n.fillStyle=o,n.font=this._ctx.font,n.textAlign="center",n.textBaseline="middle";let t=[].concat(i);for(let e=0;e<t.length;e++)n.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=e}this._ctx.drawImage(e,n*this._spacingX,r*this._spacingY)}_drawNoCache(t,e){let[n,r,i,o,s]=t;if(e){let t=this._options.border;this._ctx.fillStyle=s,this._ctx.fillRect(n*this._spacingX+t,r*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!i)return;this._ctx.fillStyle=o;let a=[].concat(i);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],(n+.5)*this._spacingX,Math.ceil((r+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let n=Math.floor(t/this._options.width),r=Math.floor(e/this._options.height),i=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=i;let s=o/100*r/n;return s>1&&(r=Math.floor(r/s)),Math.floor(r/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}g.cache=!1;class m extends p{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[n,r,i,o,s]=t,a=this._options.tileWidth,c=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(n*a,r*c,a,c):(this._ctx.fillStyle=s,this._ctx.fillRect(n*a,r*c,a,c))),!i)return;let l=[].concat(i),u=[].concat(o),h=[].concat(s);for(let t=0;t<l.length;t++){let e=this._options.tileMap[l[t]];if(!e)throw new Error(`Char "${l[t]}" not found in tileMap`);if(this._options.tileColorize){let i=this._colorCanvas,o=i.getContext("2d");o.globalCompositeOperation="source-over",o.clearRect(0,0,a,c);let s=u[t],l=h[t];o.drawImage(this._options.tileSet,e[0],e[1],a,c,0,0,a,c),"transparent"!=s&&(o.fillStyle=s,o.globalCompositeOperation="source-atop",o.fillRect(0,0,a,c)),"transparent"!=l&&(o.fillStyle=l,o.globalCompositeOperation="destination-over",o.fillRect(0,0,a,c)),this._ctx.drawImage(i,n*a,r*c,a,c)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],a,c,n*a,r*c,a,c)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var v=n(6);class y extends f.a{static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",()=>this._updateTexture(e)):this._updateTexture(e)}draw(t,e){const n=this._gl,r=this._options;let[i,o,s,a,c]=t,l=n.canvas.height-(o+1)*r.tileHeight;if(n.scissor(i*r.tileWidth,l,r.tileWidth,r.tileHeight),e&&(r.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...O(c)),n.clear(n.COLOR_BUFFER_BIT)),!s)return;let u=[].concat(s),h=[].concat(c),f=[].concat(a);n.uniform2fv(this._uniforms.targetPosRel,[i,o]);for(let t=0;t<u.length;t++){let e=this._options.tileMap[u[t]];if(!e)throw new Error(`Char "${u[t]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,r.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,e),r.tileColorize&&(n.uniform4fv(this._uniforms.tint,O(f[t])),n.uniform4fv(this._uniforms.bg,O(h[t]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...O(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let n=this._gl.canvas,r=n.getBoundingClientRect();return t-=r.left,e-=r.top,t*=n.width/r.width,e*=n.height/r.height,t<0||e<0||t>=n.width||e>=n.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,n){const r=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"");const i=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(i)||"");const o=t.createProgram();if(t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(o)||"");return o}(t,w,x);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),b.forEach(n=>this._uniforms[n]=t.getUniformLocation(e,n)),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,n=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){!function(t,e){let n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const b=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],w="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),x="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let E={};function O(t){if(!(t in E)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=v.fromString(t).map(t=>t/255),e.push(1);E[t]=e}return E[t]}var S=n(13);const T=/%([bc]){([^}]*)}/g,A=0,k=1,P=2,C=3;function M(t,e){let n={width:0,height:1},r=L(t,e),i=0;for(let t=0;t<r.length;t++){let e=r[t];switch(e.type){case A:i+=e.value.length;break;case k:n.height++,n.width=Math.max(n.width,i),i=0}}return n.width=Math.max(n.width,i),n}function L(t,e){let n=[],r=0;t.replace(T,(function(e,i,o,s){let a=t.substring(r,s);return a.length&&n.push({type:A,value:a}),n.push({type:"c"==i?P:C,value:o.trim()}),r=s+e.length,""}));let i=t.substring(r);return i.length&&n.push({type:A,value:i}),function(t,e){e||(e=1/0);let n=0,r=0,i=-1;for(;n<t.length;){let o=t[n];if(o.type==k&&(r=0,i=-1),o.type!=A){n++;continue}for(;0==r&&" "==o.value.charAt(0);)o.value=o.value.substring(1);let s=o.value.indexOf("\n");if(-1!=s){o.value=R(t,n,s,!0);let e=o.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();o.value=e.join("")}if(o.value.length){if(r+o.value.length>e){let s=-1;for(;;){let t=o.value.indexOf(" ",s+1);if(-1==t)break;if(r+t>e)break;s=t}if(-1!=s)o.value=R(t,n,s,!0);else if(-1!=i){let e=t[i],r=e.value.lastIndexOf(" ");e.value=R(t,i,r,!0),n=i}else o.value=R(t,n,e-r,!1)}else r+=o.value.length,-1!=o.value.indexOf(" ")&&(i=n);n++}else t.splice(n,1)}t.push({type:k});let o=null;for(let e=0;e<t.length;e++){let n=t[e];switch(n.type){case A:o=n;break;case k:if(o){let t=o.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();o.value=t.join("")}o=null}}return t.pop(),t}(n,e)}function R(t,e,n,r){let i={type:k},o={type:A,value:t[e].value.substring(n+(r?1:0))};return t.splice(e+1,0,i,o),t[e].value.substring(0,n)}let j=80,D=25;const K={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},V={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95},N={hex:_,rect:g,tile:m,"tile-gl":y,term:S.a},I={width:j,height:D,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class U{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},I,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,n){let r=[this._options.bg,this._options.fg];this.draw(t,e,null,null,r[n%r.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=N[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,n;return"touches"in t?(e=t.touches[0].clientX,n=t.touches[0].clientY):(e=t.clientX,n=t.clientY),this._backend.eventToPosition(e,n)}draw(t,e,n,r,i){r||(r=this._options.fg),i||(i=this._options.bg);let o=`${t},${e}`;this._data[o]=[t,e,n,r,i],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)}drawText(t,e,n,r){let i=null,o=null,s=t,a=e,c=1;r||(r=this._options.width-t);let l=L(n,r);for(;l.length;){let e=l.shift();switch(e.type){case A:let n=!1,r=!1,l=!1,u=!1;for(let t=0;t<e.value.length;t++){let c=e.value.charCodeAt(t),h=e.value.charAt(t);l=c>65280&&c<65377||c>65500&&c<65512||c>65518,n=32==h.charCodeAt(0)||12288==h.charCodeAt(0),!u||l||n||s++,l&&!r&&s++,this.draw(s++,a,h,i,o),r=n,u=l}break;case P:i=e.value||null;break;case C:o=e.value||null;break;case k:s=t,a++,c++}}return c}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let n=this._data[t];n[4]!=this._options.bg&&(e=!0),this._backend.draw(n,e)}}U.Rect=g,U.Hex=_,U.Tile=m,U.TileGL=y,U.Term=S.a;class F{constructor(t){this._options={words:!1,order:3,prior:.001},Object.assign(this._options,t),this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(let t=0;t<this._options.order;t++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}clear(){this._data={},this._priorValues={}}generate(){let t=[this._sample(this._prefix)];for(;t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))}observe(t){let e=this._split(t);for(let t=0;t<e.length;t++)this._priorValues[e[t]]=this._options.prior;e=this._prefix.concat(e).concat(this._suffix);for(let t=this._options.order;t<e.length;t++){let n=e.slice(t-this._options.order,t),r=e[t];for(let t=0;t<n.length;t++){let e=n.slice(t);this._observeEvent(e,r)}}}getStats(){let t=[],e=Object.keys(this._priorValues).length;e--,t.push("distinct samples: "+e);let n=Object.keys(this._data).length,r=0;for(let t in this._data)r+=Object.keys(this._data[t]).length;return t.push("dictionary size (contexts): "+n),t.push("dictionary size (events): "+r),t.join(", ")}_split(t){return t.split(this._options.words?/\s+/:"")}_join(t){return t.join(this._options.words?" ":"")}_observeEvent(t,e){let n=this._join(t);n in this._data||(this._data[n]={});let r=this._data[n];e in r||(r[e]=0),r[e]++}_sample(t){t=this._backoff(t);let e=this._join(t),n=this._data[e],r={};if(this._options.prior){for(let t in this._priorValues)r[t]=this._priorValues[t];for(let t in n)r[t]+=n[t]}else r=n;return h.a.getWeightedValue(r)}_backoff(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&t.length>0;)t=t.slice(1);return t}}class W{constructor(){this._time=0,this._events=[],this._eventTimes=[]}getTime(){return this._time}clear(){return this._events=[],this._eventTimes=[],this}add(t,e){let n=this._events.length;for(let t=0;t<this._eventTimes.length;t++)if(this._eventTimes[t]>e){n=t;break}this._events.splice(n,0,t),this._eventTimes.splice(n,0,e)}get(){if(!this._events.length)return null;let t=this._eventTimes.splice(0,1)[0];if(t>0){this._time+=t;for(let e=0;e<this._eventTimes.length;e++)this._eventTimes[e]-=t}return this._events.splice(0,1)[0]}getEventTime(t){let e=this._events.indexOf(t);if(-1!=e)return this._eventTimes[e]}remove(t){let e=this._events.indexOf(t);return-1!=e&&(this._remove(e),!0)}_remove(t){this._events.splice(t,1),this._eventTimes.splice(t,1)}}class Y{constructor(){this._queue=new W,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,e){return e&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let e=this._queue.remove(t),n=this._repeat.indexOf(t);return-1!=n&&this._repeat.splice(n,1),this._current==t&&(this._current=null),e}next(){return this._current=this._queue.get(),this._current}}var z={Simple:class extends Y{add(t,e){return this._queue.add(t,0),super.add(t,e)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}},Speed:class extends Y{add(t,e,n){return this._queue.add(t,void 0!==n?n:1/t.getSpeed()),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}},Action:class extends Y{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,e,n){return this._queue.add(t,n||this._defaultDuration),super.add(t,e)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}};class H{constructor(t,e={}){this._lightPasses=t,this._options=Object.assign({topology:8},e)}_getCircle(t,e,n){let r,i,o,s=[];switch(this._options.topology){case 4:i=1,o=[0,1],r=[K[8][7],K[8][1],K[8][3],K[8][5]];break;case 6:r=K[6],i=1,o=[-1,1];break;case 8:r=K[4],i=2,o=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let a=t+o[0]*n,c=e+o[1]*n;for(let t=0;t<r.length;t++)for(let e=0;e<n*i;e++)s.push([a,c]),a+=r[t][0],c+=r[t][1];return s}}const X=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];var G={DiscreteShadowcasting:class extends H{compute(t,e,n,r){if(r(t,e,0,1),!this._lightPasses(t,e))return;let i,o,s,a,c,l=[];for(let u=1;u<=n;u++){let n=this._getCircle(t,e,u),h=360/n.length;for(let t=0;t<n.length;t++)if(s=n[t][0],a=n[t][1],i=h*(t-.5),o=i+h,c=!this._lightPasses(s,a),this._visibleCoords(Math.floor(i),Math.ceil(o),c,l)&&r(s,a,u,1),2==l.length&&0==l[0]&&360==l[1])return}}_visibleCoords(t,e,n,r){if(t<0){let i=this._visibleCoords(0,e,n,r),o=this._visibleCoords(360+t,360,n,r);return i||o}let i=0;for(;i<r.length&&r[i]<t;)i++;if(i==r.length)return n&&r.push(t,e),!0;let o=0;if(i%2){for(;i<r.length&&r[i]<e;)i++,o++;return 0!=o&&(n&&(o%2?r.splice(i-o,o,e):r.splice(i-o,o)),!0)}for(;i<r.length&&r[i]<e;)i++,o++;return(t!=r[i-o]||1!=o)&&(n&&(o%2?r.splice(i-o,o,t):r.splice(i-o,o,t,e)),!0)}},PreciseShadowcasting:class extends H{compute(t,e,n,r){if(r(t,e,0,1),!this._lightPasses(t,e))return;let i,o,s,a,c,l,u=[];for(let h=1;h<=n;h++){let n=this._getCircle(t,e,h),f=n.length;for(let t=0;t<f;t++)if(i=n[t][0],o=n[t][1],a=[t?2*t-1:2*f-1,2*f],c=[2*t+1,2*f],s=!this._lightPasses(i,o),l=this._checkVisibility(a,c,s,u),l&&r(i,o,h,l),2==u.length&&0==u[0][0]&&u[1][0]==u[1][1])return}}_checkVisibility(t,e,n,r){if(t[0]>e[0]){return(this._checkVisibility(t,[t[1],t[1]],n,r)+this._checkVisibility([0,1],e,n,r))/2}let i=0,o=!1;for(;i<r.length;){let e=r[i],n=e[0]*t[1]-t[0]*e[1];if(n>=0){0!=n||i%2||(o=!0);break}i++}let s=r.length,a=!1;for(;s--;){let t=r[s],n=e[0]*t[1]-t[0]*e[1];if(n>=0){0==n&&s%2&&(a=!0);break}}let c,l=!0;if((i==s&&(o||a)||o&&a&&i+1==s&&s%2||i>s&&i%2)&&(l=!1),!l)return 0;let u=s-i+1;if(u%2)if(i%2){let t=r[i];c=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),n&&r.splice(i,u,e)}else{let e=r[s];c=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),n&&r.splice(i,u,t)}else{if(!(i%2))return n&&r.splice(i,u,t,e),1;{let t=r[i],e=r[s];c=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),n&&r.splice(i,u)}}return c/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))}},RecursiveShadowcasting:class extends H{compute(t,e,n,r){r(t,e,0,1);for(let i=0;i<X.length;i++)this._renderOctant(t,e,X[i],n,r)}compute180(t,e,n,r,i){i(t,e,0,1);let o=(r-1+8)%8,s=(r-2+8)%8,a=(r+1+8)%8;this._renderOctant(t,e,X[s],n,i),this._renderOctant(t,e,X[o],n,i),this._renderOctant(t,e,X[r],n,i),this._renderOctant(t,e,X[a],n,i)}compute90(t,e,n,r,i){i(t,e,0,1);let o=(r-1+8)%8;this._renderOctant(t,e,X[r],n,i),this._renderOctant(t,e,X[o],n,i)}_renderOctant(t,e,n,r,i){this._castVisibility(t,e,1,1,0,r+1,n[0],n[1],n[2],n[3],i)}_castVisibility(t,e,n,r,i,o,s,a,c,l,u){if(!(r<i))for(let h=n;h<=o;h++){let n=-h-1,f=-h,p=!1,d=0;for(;n<=0;){n+=1;let _=t+n*s+f*a,g=e+n*c+f*l,m=(n-.5)/(f+.5),v=(n+.5)/(f-.5);if(!(v>r)){if(m<i)break;if(n*n+f*f<o*o&&u(_,g,h,1),p){if(!this._lightPasses(_,g)){d=v;continue}p=!1,r=d}else!this._lightPasses(_,g)&&h<o&&(p=!0,this._castVisibility(t,e,h+1,r,m,o,s,a,c,l,u),d=v)}}if(p)break}}}};class q{constructor(t=j,e=D){this._width=t,this._height=e}_fillMap(t){let e=[];for(let n=0;n<this._width;n++){e.push([]);for(let r=0;r<this._height;r++)e[n].push(t)}return e}}class B extends q{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class ${}class J extends ${constructor(t,e,n,r,i,o){super(),this._x1=t,this._y1=e,this._x2=n,this._y2=r,this._doors={},void 0!==i&&void 0!==o&&this.addDoor(i,o)}static createRandomAt(t,e,n,r,i){let o=i.roomWidth[0],s=i.roomWidth[1],a=h.a.getUniformInt(o,s);o=i.roomHeight[0],s=i.roomHeight[1];let c=h.a.getUniformInt(o,s);if(1==n){let n=e-Math.floor(h.a.getUniform()*c);return new this(t+1,n,t+a,n+c-1,t,e)}if(-1==n){let n=e-Math.floor(h.a.getUniform()*c);return new this(t-a,n,t-1,n+c-1,t,e)}if(1==r){let n=t-Math.floor(h.a.getUniform()*a);return new this(n,e+1,n+a-1,e+c,t,e)}if(-1==r){let n=t-Math.floor(h.a.getUniform()*a);return new this(n,e-c,n+a-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,n){let r=n.roomWidth[0],i=n.roomWidth[1],o=h.a.getUniformInt(r,i);r=n.roomHeight[0],i=n.roomHeight[1];let s=h.a.getUniformInt(r,i),a=t-Math.floor(h.a.getUniform()*o),c=e-Math.floor(h.a.getUniform()*s);return new this(a,c,a+o-1,c+s-1)}static createRandom(t,e,n){let r=n.roomWidth[0],i=n.roomWidth[1],o=h.a.getUniformInt(r,i);r=n.roomHeight[0],i=n.roomHeight[1];let s=h.a.getUniformInt(r,i),a=t-o-1,c=e-s-1,l=1+Math.floor(h.a.getUniform()*a),u=1+Math.floor(h.a.getUniform()*c);return new this(l,u,l+o-1,u+s-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let n=e.split(",");t(parseInt(n[0]),parseInt(n[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,n=this._x2+1,r=this._y1-1,i=this._y2+1;for(let o=e;o<=n;o++)for(let s=r;s<=i;s++)o!=e&&o!=n&&s!=r&&s!=i||t(o,s)||this.addDoor(o,s);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let n=this._x1-1,r=this._x2+1,i=this._y1-1,o=this._y2+1;for(let s=n;s<=r;s++)for(let a=i;a<=o;a++)if(s==n||s==r||a==i||a==o){if(!t(s,a))return!1}else if(!e(s,a))return!1;return!0}create(t){let e=this._x1-1,n=this._x2+1,r=this._y1-1,i=this._y2+1,o=0;for(let s=e;s<=n;s++)for(let a=r;a<=i;a++)o=s+","+a in this._doors?2:s==e||s==n||a==r||a==i?1:0,t(s,a,o)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class Q extends ${constructor(t,e,n,r){super(),this._startX=t,this._startY=e,this._endX=n,this._endY=r,this._endsWithAWall=!0}static createRandomAt(t,e,n,r,i){let o=i.corridorLength[0],s=i.corridorLength[1],a=h.a.getUniformInt(o,s);return new this(t,e,t+n*a,e+r*a)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let n=this._startX,r=this._startY,i=this._endX-n,o=this._endY-r,s=1+Math.max(Math.abs(i),Math.abs(o));i&&(i/=Math.abs(i)),o&&(o/=Math.abs(o));let a=o,c=-i,l=!0;for(let u=0;u<s;u++){let h=n+u*i,f=r+u*o;if(e(h,f)||(l=!1),t(h+a,f+c)||(l=!1),t(h-a,f-c)||(l=!1),!l){s=u,this._endX=h-i,this._endY=f-o;break}}if(0==s)return!1;if(1==s&&t(this._endX+i,this._endY+o))return!1;let u=!t(this._endX+i+a,this._endY+o+c),h=!t(this._endX+i-a,this._endY+o-c);return this._endsWithAWall=t(this._endX+i,this._endY+o),!u&&!h||!this._endsWithAWall}create(t){let e=this._startX,n=this._startY,r=this._endX-e,i=this._endY-n,o=1+Math.max(Math.abs(r),Math.abs(i));r&&(r/=Math.abs(r)),i&&(i/=Math.abs(i));for(let s=0;s<o;s++){t(e+s*r,n+s*i,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,n=this._startY,r=this._endX-e,i=this._endY-n;r&&(r/=Math.abs(r)),i&&(i/=Math.abs(i));let o=i,s=-r;t(this._endX+r,this._endY+i),t(this._endX+o,this._endY+s),t(this._endX-o,this._endY-s)}}const Z={room:J,corridor:Q};function tt(t,e,n){n[e[t+1]]=n[t],e[n[t]]=e[t+1],n[t]=t+1,e[t+1]=t}function et(t,e,n){n[e[t]]=n[t],e[n[t]]=e[t],n[t]=t,e[t]=t}var nt={Arena:class extends q{create(t){let e=this._width-1,n=this._height-1;for(let r=0;r<=e;r++)for(let i=0;i<=n;i++){t(r,i,r&&i&&r<e&&i<n?0:1)}return this}},Uniform:class extends B{constructor(t,e,n){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,n),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this._map[e][n]);return this}_generateRooms(){let t,e=this._width-2,n=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*n)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=J.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=h.a.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=h.a.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let n=this._closestRoom(this._connected,e);if(!n)break;if(!this._connectRooms(e,n))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let n=1/0,r=e.getCenter(),i=null;for(let e=0;e<t.length;e++){let o=t[e],s=o.getCenter(),a=s[0]-r[0],c=s[1]-r[1],l=a*a+c*c;l<n&&(n=l,i=o)}return i}_connectRooms(t,e){let n,r,i,o,s,a,c,l=t.getCenter(),u=e.getCenter(),h=u[0]-l[0],f=u[1]-l[1];if(Math.abs(h)<Math.abs(f)?(i=f>0?2:0,o=(i+2)%4,s=e.getLeft(),a=e.getRight(),c=0):(i=h>0?1:3,o=(i+2)%4,s=e.getTop(),a=e.getBottom(),c=1),n=this._placeInWall(t,i),!n)return!1;if(n[c]>=s&&n[c]<=a){r=n.slice();let t=0;switch(o){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}r[(c+1)%2]=t,this._digLine([n,r])}else if(n[c]<s-1||n[c]>a+1){let t=n[c]-u[c],i=0;switch(o){case 0:case 1:i=t<0?3:1;break;case 2:case 3:i=t<0?1:3}if(o=(o+i)%4,r=this._placeInWall(e,o),!r)return!1;let s=[0,0];s[c]=n[c];let a=(c+1)%2;s[a]=r[a],this._digLine([n,s,r])}else{let t=(c+1)%2;if(r=this._placeInWall(e,o),!r)return!1;let i=Math.round((r[t]+n[t])/2),s=[0,0],a=[0,0];s[c]=n[c],s[t]=i,a[c]=r[c],a[t]=i,this._digLine([n,s,a,r])}return t.addDoor(n[0],n[1]),e.addDoor(r[0],r[1]),c=this._unconnected.indexOf(t),-1!=c&&(this._unconnected.splice(c,1),this._connected.push(t)),c=this._unconnected.indexOf(e),-1!=c&&(this._unconnected.splice(c,1),this._connected.push(e)),!0}_placeInWall(t,e){let n=[0,0],r=[0,0],i=0;switch(e){case 0:r=[1,0],n=[t.getLeft(),t.getTop()-1],i=t.getRight()-t.getLeft()+1;break;case 1:r=[0,1],n=[t.getRight()+1,t.getTop()],i=t.getBottom()-t.getTop()+1;break;case 2:r=[1,0],n=[t.getLeft(),t.getBottom()+1],i=t.getRight()-t.getLeft()+1;break;case 3:r=[0,1],n=[t.getLeft()-1,t.getTop()],i=t.getBottom()-t.getTop()+1}let o=[],s=-2;for(let t=0;t<i;t++){let e=n[0]+t*r[0],i=n[1]+t*r[1];o.push(null),1==this._map[e][i]?s!=t-1&&(o[t]=[e,i]):(s=t,t&&(o[t-1]=null))}for(let t=o.length-1;t>=0;t--)o[t]||o.splice(t,1);return o.length?h.a.getItem(o):null}_digLine(t){for(let e=1;e<t.length;e++){let n=t[e-1],r=t[e],i=new Q(n[0],n[1],r[0],r[1]);i.create(this._digCallback),this._corridors.push(i)}}_digCallback(t,e,n){this._map[t][e]=n,0==n&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends q{constructor(t,e,n={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(n),this._dirs=K[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)this._map[e][n]=h.a.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,n){this._map[t][e]=n}create(t){let e=this._fillMap(0),n=this._options.born,r=this._options.survive;for(let t=0;t<this._height;t++){let i=1,o=0;6==this._options.topology&&(i=2,o=t%2);for(let s=o;s<this._width;s+=i){let i=this._map[s][t],o=this._getNeighbors(s,t);i&&-1!=r.indexOf(o)?e[s][t]=1:i||-1==n.indexOf(o)||(e[s][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let n=1,r=0;6==this._options.topology&&(n=2,r=e%2);for(let i=r;i<this._width;i+=n)t(i,e,this._map[i][e])}}_getNeighbors(t,e){let n=0;for(let r=0;r<this._dirs.length;r++){let i=this._dirs[r],o=t+i[0],s=e+i[1];o<0||o>=this._width||s<0||s>=this._height||(n+=1==this._map[o][s]?1:0)}return n}connect(t,e,n){e||(e=0);let r=[],i={},o=1,s=[0,0];6==this._options.topology&&(o=2,s=[0,1]);for(let t=0;t<this._height;t++)for(let n=s[t%2];n<this._width;n+=o)if(this._freeSpace(n,t,e)){let e=[n,t];i[this._pointKey(e)]=e,r.push([n,t])}let a=r[h.a.getUniformInt(0,r.length-1)],c=this._pointKey(a),l={};for(l[c]=a,delete i[c],this._findConnected(l,i,[a],!1,e);Object.keys(i).length>0;){let t=this._getFromTo(l,i),r=t[0],o=t[1],s={};s[this._pointKey(r)]=r,this._findConnected(s,i,[r],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,o,r,l,i,e,n);for(let t in s){let n=s[t];this._map[n[0]][n[1]]=e,l[t]=n,delete i[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let n,r=[0,0],i=[0,0],o=Object.keys(t),s=Object.keys(e);for(let a=0;a<5;a++){if(o.length<s.length){let n=o;i=t[n[h.a.getUniformInt(0,n.length-1)]],r=this._getClosest(i,e)}else{let n=s;r=e[n[h.a.getUniformInt(0,n.length-1)]],i=this._getClosest(r,t)}if(n=(r[0]-i[0])*(r[0]-i[0])+(r[1]-i[1])*(r[1]-i[1]),n<64)break}return[r,i]}_getClosest(t,e){let n=null,r=null;for(let i in e){let o=e[i],s=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(null==r||s<r)&&(r=s,n=o)}return n}_findConnected(t,e,n,r,i){for(;n.length>0;){let o,s=n.splice(0,1)[0];o=6==this._options.topology?[[s[0]+2,s[1]],[s[0]+1,s[1]-1],[s[0]-1,s[1]-1],[s[0]-2,s[1]],[s[0]-1,s[1]+1],[s[0]+1,s[1]+1]]:[[s[0]+1,s[1]],[s[0]-1,s[1]],[s[0],s[1]+1],[s[0],s[1]-1]];for(let s=0;s<o.length;s++){let a=this._pointKey(o[s]);null==t[a]&&this._freeSpace(o[s][0],o[s][1],i)&&(t[a]=o[s],r||delete e[a],n.push(o[s]))}}}_tunnelToConnected(t,e,n,r,i,o){let s,a;e[0]<t[0]?(s=e,a=t):(s=t,a=e);for(let t=s[0];t<=a[0];t++){this._map[t][s[1]]=i;let e=[t,s[1]],o=this._pointKey(e);n[o]=e,delete r[o]}o&&s[0]<a[0]&&o(s,[a[0],s[1]]);let c=a[0];e[1]<t[1]?(s=e,a=t):(s=t,a=e);for(let t=s[1];t<a[1];t++){this._map[c][t]=i;let e=[c,t],o=this._pointKey(e);n[o]=e,delete r[o]}o&&s[1]<a[1]&&o([a[0],s[1]],[a[0],a[1]])}_tunnelToConnected6(t,e,n,r,i,o){let s,a;e[0]<t[0]?(s=e,a=t):(s=t,a=e);let c=s[0],l=s[1];for(;c!=a[0]||l!=a[1];){let t=2;l<a[1]?(l++,t=1):l>a[1]&&(l--,t=1),c<a[0]?c+=t:c>a[0]||a[1]%2?c-=t:c+=t,this._map[c][l]=i;let e=[c,l],o=this._pointKey(e);n[o]=e,delete r[o]}o&&o(e,t)}_freeSpace(t,e,n){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==n}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends B{constructor(t,e,n={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},n),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let n,r=Date.now();do{if(n=0,Date.now()-r>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),i=parseInt(e[0]),o=parseInt(e[1]),s=this._getDiggingDirection(i,o);if(!s)continue;let a=0;do{if(a++,this._tryFeature(i,o,s[0],s[1])){this._removeSurroundingWalls(i,o),this._removeSurroundingWalls(i-s[0],o-s[1]);break}}while(a<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&n++}while(this._dug/e<this._options.dugPercentage||n);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this._map[e][n]);return this._walls={},this._map=[],this}_digCallback(t,e,n){0==n||2==n?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),n=J.createRandomCenter(t,e,this._options);this._rooms.push(n),n.create(this._digCallback)}_findWall(){let t=[],e=[];for(let n in this._walls){2==this._walls[n]?e.push(n):t.push(n)}let n=e.length?e:t;if(!n.length)return null;let r=h.a.getItem(n.sort());return delete this._walls[r],r}_tryFeature(t,e,n,r){let i=h.a.getWeightedValue(this._features),o=Z[i].createRandomAt(t,e,n,r,this._options);return!!o.isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof J&&this._rooms.push(o),o instanceof Q&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)}_removeSurroundingWalls(t,e){let n=K[4];for(let r=0;r<n.length;r++){let i=n[r],o=t+i[0],s=e+i[1];delete this._walls[o+","+s],o=t+2*i[0],s=e+2*i[1],delete this._walls[o+","+s]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let n=null,r=K[4];for(let i=0;i<r.length;i++){let o=r[i],s=t+o[0],a=e+o[1];if(!this._map[s][a]){if(n)return null;n=o}}return n?[-n[0],-n[1]]:null}_addDoors(){let t=this._map;function e(e,n){return 1==t[e][n]}for(let t=0;t<this._rooms.length;t++){let n=this._rooms[t];n.clearDoors(),n.addDoors(e)}}},EllerMaze:class extends q{create(t){let e,n=this._fillMap(1),r=Math.ceil((this._width-2)/2),i=[],o=[];for(let t=0;t<r;t++)i.push(t),o.push(t);for(i.push(r-1),e=1;e+3<this._height;e+=2)for(let t=0;t<r;t++){let r=2*t+1,s=e;n[r][s]=0,t!=i[t+1]&&h.a.getUniform()>9/24&&(tt(t,i,o),n[r+1][s]=0),t!=i[t]&&h.a.getUniform()>9/24?et(t,i,o):n[r][s+1]=0}for(let t=0;t<r;t++){let r=2*t+1,s=e;n[r][s]=0,t!=i[t+1]&&(t==i[t]||h.a.getUniform()>9/24)&&(tt(t,i,o),n[r+1][s]=0),et(t,i,o)}for(let e=0;e<this._width;e++)for(let r=0;r<this._height;r++)t(e,r,n[e][r]);return this}},DividedMaze:class extends q{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,n=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let r=0;r<n;r++){let i=0==t||0==r||t+1==e||r+1==n;this._map[t].push(i?1:0)}}this._stack=[[1,1,e-2,n-2]],this._process();for(let r=0;r<e;r++)for(let e=0;e<n;e++)t(r,e,this._map[r][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],n=[];for(let n=t[0]+1;n<t[2];n++){let r=this._map[n][t[1]-1],i=this._map[n][t[3]+1];!r||!i||n%2||e.push(n)}for(let e=t[1]+1;e<t[3];e++){let r=this._map[t[0]-1][e],i=this._map[t[2]+1][e];!r||!i||e%2||n.push(e)}if(!e.length||!n.length)return;let r=h.a.getItem(e),i=h.a.getItem(n);this._map[r][i]=1;let o=[],s=[];o.push(s);for(let e=t[0];e<r;e++)this._map[e][i]=1,s.push([e,i]);s=[],o.push(s);for(let e=r+1;e<=t[2];e++)this._map[e][i]=1,s.push([e,i]);s=[],o.push(s);for(let e=t[1];e<i;e++)this._map[r][e]=1,s.push([r,e]);s=[],o.push(s);for(let e=i+1;e<=t[3];e++)this._map[r][e]=1,s.push([r,e]);let a=h.a.getItem(o);for(let t=0;t<o.length;t++){let e=o[t];if(e==a)continue;let n=h.a.getItem(e);this._map[n[0]][n[1]]=0}this._stack.push([t[0],t[1],r-1,i-1]),this._stack.push([r+1,t[1],t[2],i-1]),this._stack.push([t[0],i+1,r-1,t[3]]),this._stack.push([r+1,i+1,t[2],t[3]])}},IceyMaze:class extends q{constructor(t,e,n=0){super(t,e),this._regularity=n,this._map=[]}create(t){let e=this._width,n=this._height,r=this._fillMap(1);e-=e%2?1:2,n-=n%2?1:2;let i=0,o=0,s=0,a=0,c=0,l=!1,u=[[0,0],[0,0],[0,0],[0,0]];do{if(i=1+2*Math.floor(h.a.getUniform()*(e-1)/2),o=1+2*Math.floor(h.a.getUniform()*(n-1)/2),c||(r[i][o]=0),!r[i][o]){this._randomize(u);do{0==Math.floor(h.a.getUniform()*(this._regularity+1))&&this._randomize(u),l=!0;for(let t=0;t<4;t++)if(s=i+2*u[t][0],a=o+2*u[t][1],this._isFree(r,s,a,e,n)){r[s][a]=0,r[i+u[t][0]][o+u[t][1]]=0,i=s,o=a,l=!1,c++;break}}while(!l)}}while(c+1<e*n/4);for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,r[e][n]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*h.a.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,n,r,i){return!(e<1||n<1||e>=r||n>=i)&&t[e][n]}},Rogue:class extends q{constructor(t,e,n){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(n=Object.assign({cellWidth:3,cellHeight:3},n)).hasOwnProperty("roomWidth")||(n.roomWidth=this._calculateRoomSize(this._width,n.cellWidth)),n.hasOwnProperty("roomHeight")||(n.roomHeight=this._calculateRoomSize(this._height,n.cellHeight)),this._options=n}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this.map[e][n]);return this}_calculateRoomSize(t,e){let n=Math.floor(t/e*.8),r=Math.floor(t/e*.25);return r<2&&(r=2),n<2&&(n=2),[r,n]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,n,r,i,o,s=h.a.getUniformInt(0,this._options.cellWidth-1),a=h.a.getUniformInt(0,this._options.cellHeight-1),c=!1;do{o=[0,2,4,6],o=h.a.shuffle(o);do{if(c=!1,t=o.pop(),e=s+K[8][t][0],n=a+K[8][t][1],!(e<0||e>=this._options.cellWidth||n<0||n>=this._options.cellHeight)){if(r=this.rooms[s][a],r.connections.length>0&&r.connections[0][0]==e&&r.connections[0][1]==n)break;i=this.rooms[e][n],0==i.connections.length&&(i.connections.push([s,a]),this.connectedCells.push([e,n]),s=e,a=n,c=!0)}}while(o.length>0&&0==c)}while(o.length>0)}_connectUnconnectedRooms(){let t,e,n,r=this._options.cellWidth,i=this._options.cellHeight;this.connectedCells=h.a.shuffle(this.connectedCells);for(let o=0;o<this._options.cellWidth;o++)for(let s=0;s<this._options.cellHeight;s++)if(t=this.rooms[o][s],0==t.connections.length){let a=[0,2,4,6];a=h.a.shuffle(a),n=!1;do{let t=a.pop(),c=o+K[8][t][0],l=s+K[8][t][1];if(!(c<0||c>=r||l<0||l>=i)){if(e=this.rooms[c][l],n=!0,0==e.connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==o&&e.connections[t][1]==s){n=!1;break}if(n)break}}while(a.length);n?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,n,r,i,o=this._width,s=this._height,a=this._options.cellWidth,c=this._options.cellHeight,l=Math.floor(this._width/a),u=Math.floor(this._height/c),f=this._options.roomWidth,p=this._options.roomHeight;for(let d=0;d<a;d++)for(let a=0;a<c;a++){if(n=l*d,r=u*a,0==n&&(n=1),0==r&&(r=1),t=h.a.getUniformInt(f[0],f[1]),e=h.a.getUniformInt(p[0],p[1]),a>0)for(i=this.rooms[d][a-1];r-(i.y+i.height)<3;)r++;if(d>0)for(i=this.rooms[d-1][a];n-(i.x+i.width)<3;)n++;let c=Math.round(h.a.getUniformInt(0,l-t)/2),_=Math.round(h.a.getUniformInt(0,u-e)/2);for(;n+c+t>=o;)c?c--:t--;for(;r+_+e>=s;)_?_--:e--;n+=c,r+=_,this.rooms[d][a].x=n,this.rooms[d][a].y=r,this.rooms[d][a].width=t,this.rooms[d][a].height=e;for(let i=n;i<n+t;i++)for(let t=r;t<r+e;t++)this.map[i][t]=0}}_getWallPosition(t,e){let n,r,i;return 1==e||3==e?(n=h.a.getUniformInt(t.x+1,t.x+t.width-2),1==e?(r=t.y-2,i=r+1):(r=t.y+t.height+1,i=r-1),this.map[n][i]=0):(r=h.a.getUniformInt(t.y+1,t.y+t.height-2),2==e?(n=t.x+t.width+1,i=n-1):(n=t.x-2,i=n+1),this.map[i][r]=0),[n,r]}_drawCorridor(t,e){let n,r,i,o,s=e[0]-t[0],a=e[1]-t[1],c=t[0],l=t[1],u=[],f=Math.abs(s),p=Math.abs(a),d=h.a.getUniform(),_=d,g=1-d;for(r=s>0?2:6,i=a>0?4:0,f<p?(n=Math.ceil(p*_),u.push([i,n]),u.push([r,f]),n=Math.floor(p*g),u.push([i,n])):(n=Math.ceil(f*_),u.push([r,n]),u.push([i,p]),n=Math.floor(f*g),u.push([r,n])),this.map[c][l]=0;u.length>0;)for(o=u.pop();o[1]>0;)c+=K[8][o[0]][0],l+=K[8][o[0]][1],this.map[c][l]=0,o[1]=o[1]-1}_createCorridors(){let t,e,n,r,i,o=this._options.cellWidth,s=this._options.cellHeight;for(let a=0;a<o;a++)for(let o=0;o<s;o++){t=this.rooms[a][o];for(let o=0;o<t.connections.length;o++)e=t.connections[o],n=this.rooms[e[0]][e[1]],n.cellx>t.cellx?(r=2,i=4):n.cellx<t.cellx?(r=4,i=2):n.celly>t.celly?(r=3,i=1):(r=1,i=3),this._drawCorridor(this._getWallPosition(t,r),this._getWallPosition(n,i))}}}};const rt=.5*(Math.sqrt(3)-1),it=(3-Math.sqrt(3))/6;var ot={Simplex:class extends class{}{constructor(t=256){super(),this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];let e=[];for(let n=0;n<t;n++)e.push(n);e=h.a.shuffle(e),this._perms=[],this._indexes=[];for(let n=0;n<2*t;n++)this._perms.push(e[n%t]),this._indexes.push(this._perms[n]%this._gradients.length)}get(t,e){let n,r,i,o=this._perms,s=this._indexes,a=o.length/2,c=0,l=0,u=0,h=(t+e)*rt,f=Math.floor(t+h),p=Math.floor(e+h),_=(f+p)*it,g=t-(f-_),m=e-(p-_);g>m?(r=1,i=0):(r=0,i=1);let v=g-r+it,y=m-i+it,b=g-1+2*it,w=m-1+2*it,x=Object(d.mod)(f,a),E=Object(d.mod)(p,a),O=.5-g*g-m*m;if(O>=0){O*=O,n=s[x+o[E]];let t=this._gradients[n];c=O*O*(t[0]*g+t[1]*m)}let S=.5-v*v-y*y;if(S>=0){S*=S,n=s[x+r+o[E+i]];let t=this._gradients[n];l=S*S*(t[0]*v+t[1]*y)}let T=.5-b*b-w*w;if(T>=0){T*=T,n=s[x+1+o[E+1]];let t=this._gradients[n];u=T*T*(t[0]*b+t[1]*w)}return 70*(c+l+u)}}};class st{constructor(t,e,n,r={}){this._toX=t,this._toY=e,this._passableCallback=n,this._options=Object.assign({topology:8},r),this._dirs=K[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(t,e){let n=[];for(let r=0;r<this._dirs.length;r++){let i=this._dirs[r],o=t+i[0],s=e+i[1];this._passableCallback(o,s)&&n.push([o,s])}return n}}var at={Dijkstra:class extends st{constructor(t,e,n,r){super(t,e,n,r),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,n){let r=t+","+e;if(r in this._computed||this._compute(t,e),!(r in this._computed))return;let i=this._computed[r];for(;i;)n(i.x,i.y),i=i.prev}_compute(t,e){for(;this._todo.length;){let n=this._todo.shift();if(n.x==t&&n.y==e)return;let r=this._getNeighbors(n.x,n.y);for(let t=0;t<r.length;t++){let e=r[t],i=e[0],o=e[1];i+","+o in this._computed||this._add(i,o,n)}}}_add(t,e,n){let r={x:t,y:e,prev:n};this._computed[t+","+e]=r,this._todo.push(r)}},AStar:class extends st{constructor(t,e,n,r={}){super(t,e,n,r),this._todo=[],this._done={}}compute(t,e,n){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){let n=this._todo.shift(),r=n.x+","+n.y;if(r in this._done)continue;if(this._done[r]=n,n.x==t&&n.y==e)break;let i=this._getNeighbors(n.x,n.y);for(let t=0;t<i.length;t++){let e=i[t],r=e[0],o=e[1];r+","+o in this._done||this._add(r,o,n)}}let r=this._done[t+","+e];if(r)for(;r;)n(r.x,r.y),r=r.prev}_add(t,e,n){let r=this._distance(t,e),i={x:t,y:e,prev:n,g:n?n.g+1:0,h:r},o=i.g+i.h;for(let t=0;t<this._todo.length;t++){let e=this._todo[t],n=e.g+e.h;if(o<n||o==n&&r<e.h)return void this._todo.splice(t,0,i)}this._todo.push(i)}_distance(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:let n=Math.abs(t-this._fromX),r=Math.abs(e-this._fromY);return r+Math.max(0,(n-r)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}}}};class ct{constructor(t){this._scheduler=t,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let t=this._scheduler.next();if(!t)return this.lock();let e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this}}class lt{constructor(t,e={}){this._reflectivityCallback=t,this._options={},e=Object.assign({passes:1,emissionThreshold:100,range:10},e),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)}setOptions(t){return Object.assign(this._options,t),t&&t.range&&this.reset(),this}setFOV(t){return this._fov=t,this._fovCache={},this}setLight(t,e,n){let r=t+","+e;return n?this._lights[r]="string"==typeof n?v.fromString(n):n:delete this._lights[r],this}clearLights(){this._lights={}}reset(){return this._reflectivityCache={},this._fovCache={},this}compute(t){let e={},n={},r={};for(let t in this._lights){let e=this._lights[t];n[t]=[0,0,0],v.add_(n[t],e)}for(let t=0;t<this._options.passes;t++)this._emitLight(n,r,e),t+1!=this._options.passes&&(n=this._computeEmitters(r,e));for(let e in r){let n=e.split(",");t(parseInt(n[0]),parseInt(n[1]),r[e])}return this}_emitLight(t,e,n){for(let r in t){let i=r.split(","),o=parseInt(i[0]),s=parseInt(i[1]);this._emitLightFromCell(o,s,t[r],e),n[r]=1}return this}_computeEmitters(t,e){let n={};for(let r in t){if(r in e)continue;let i,o=t[r];if(r in this._reflectivityCache)i=this._reflectivityCache[r];else{let t=r.split(","),e=parseInt(t[0]),n=parseInt(t[1]);i=this._reflectivityCallback(e,n),this._reflectivityCache[r]=i}if(0==i)continue;let s=[0,0,0],a=0;for(let t=0;t<3;t++){let e=Math.round(o[t]*i);s[t]=e,a+=e}a>this._options.emissionThreshold&&(n[r]=s)}return n}_emitLightFromCell(t,e,n,r){let i,o=t+","+e;i=o in this._fovCache?this._fovCache[o]:this._updateFOV(t,e);for(let t in i){let e,o=i[t];t in r?e=r[t]:(e=[0,0,0],r[t]=e);for(let t=0;t<3;t++)e[t]+=Math.round(n[t]*o)}return this}_updateFOV(t,e){let n=t+","+e,r={};this._fovCache[n]=r;let i=this._options.range;return this._fov.compute(t,e,i,function(t,e,n,o){let s=o*(1-n/i);0!=s&&(r[t+","+e]=s)}.bind(this)),r}}const ut=d,ht=v,ft=r;var pt=n(14),dt=function(){return Math.random().toString(36).substring(7).split("").join(".")},_t={INIT:"@@redux/INIT"+dt(),REPLACE:"@@redux/REPLACE"+dt(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+dt()}};function gt(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vt(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n}function yt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vt(n,!0).forEach((function(e){mt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function bt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}))}var wt=n(19),xt=function(t){return"@@redux-saga/"+t},Et=xt("CANCEL_PROMISE"),Ot=xt("CHANNEL_END"),St=xt("IO"),Tt=xt("MATCH"),At=xt("MULTICAST"),kt=xt("SAGA_ACTION"),Pt=xt("SELF_CANCELLATION"),Ct=xt("TASK"),Mt=xt("TASK_CANCEL"),Lt=xt("TERMINATE"),Rt=xt("LOCATION");function jt(){return(jt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Dt=function(t){return null==t},Kt=function(t){return null!=t},Vt=function(t){return"function"==typeof t},Nt=function(t){return"string"==typeof t},It=Array.isArray,Ut=function(t){return t&&Vt(t.then)},Ft=function(t){return t&&Vt(t.next)&&Vt(t.throw)},Wt=function t(e){return e&&(Nt(e)||Ht(e)||Vt(e)||It(e)&&e.every(t))},Yt=function(t){return t&&Vt(t.take)&&Vt(t.close)},zt=function(t){return Vt(t)&&t.hasOwnProperty("toString")},Ht=function(t){return Boolean(t)&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype};var Xt=function(t){return function(){return t}}(!0),Gt=function(){};var qt=function(t){return t};"function"==typeof Symbol&&Symbol.asyncIterator&&Symbol.asyncIterator;var Bt=function(t,e){jt(t,e),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach((function(n){t[n]=e[n]}))};function $t(t,e){var n=t.indexOf(e);n>=0&&t.splice(n,1)}function Jt(t){var e=!1;return function(){e||(e=!0,t())}}var Qt=function(t){throw t},Zt=function(t){return{value:t,done:!0}};function te(t,e,n){void 0===e&&(e=Qt),void 0===n&&(n="iterator");var r={meta:{name:n},next:t,throw:e,return:Zt,isSagaIterator:!0};return"undefined"!=typeof Symbol&&(r[Symbol.iterator]=function(){return r}),r}function ee(t,e){var n=e.sagaStack;console.error(t),console.error(n)}var ne=function(t){return Array.apply(null,new Array(t))},re=function(t){return function(e){return t(Object.defineProperty(e,kt,{value:!0}))}},ie=function(t){return t===Lt},oe=function(t){return t===Mt},se=function(t){return ie(t)||oe(t)};function ae(t,e){var n=Object.keys(t),r=n.length;var i,o=0,s=It(t)?ne(r):{},a={};return n.forEach((function(t){var n=function(n,a){i||(a||se(n)?(e.cancel(),e(n,a)):(s[t]=n,++o===r&&(i=!0,e(s))))};n.cancel=Gt,a[t]=n})),e.cancel=function(){i||(i=!0,n.forEach((function(t){return a[t].cancel()})))},a}function ce(t){return{name:t.name||"anonymous",location:le(t)}}function le(t){return t[Rt]}function ue(t,e){void 0===t&&(t=10);var n=new Array(t),r=0,i=0,o=0,s=function(e){n[i]=e,i=(i+1)%t,r++},a=function(){if(0!=r){var e=n[o];return n[o]=null,r--,o=(o+1)%t,e}},c=function(){for(var t=[];r;)t.push(a());return t};return{isEmpty:function(){return 0==r},put:function(a){var l;if(r<t)s(a);else switch(e){case 1:throw new Error("Channel's Buffer overflow!");case 3:n[i]=a,o=i=(i+1)%t;break;case 4:l=2*t,n=c(),r=n.length,i=n.length,o=0,n.length=l,t=l,s(a)}},take:a,flush:c}}var he=function(t){return ue(t,4)},fe=function(t,e){var n;return(n={})[St]=!0,n.combinator=!1,n.type=t,n.payload=e,n};function pe(t,e){return void 0===t&&(t="*"),Wt(t)?fe("TAKE",{pattern:t}):Yt(n=t)&&n[At]&&Kt(e)&&Wt(e)?fe("TAKE",{channel:t,pattern:e}):Yt(t)?fe("TAKE",{channel:t}):void 0;var n}function de(t,e){return Dt(e)&&(e=t,t=void 0),fe("PUT",{channel:t,action:e})}function _e(t,e){var n,r=null;return Vt(t)?n=t:(It(t)?(r=t[0],n=t[1]):(r=t.context,n=t.fn),r&&Nt(n)&&Vt(r[n])&&(n=r[n])),{context:r,fn:n,args:e}}function ge(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return fe("FORK",_e(t,n))}function me(t){void 0===t&&(t=qt);for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return fe("SELECT",{selector:t,args:n})}function ve(){var t={};return t.promise=new Promise((function(e,n){t.resolve=e,t.reject=n})),t}var ye=ve,be=[],we=0;function xe(t){try{Se(),t()}finally{Te()}}function Ee(t){be.push(t),we||(Se(),Ae())}function Oe(t){try{return Se(),t()}finally{Ae()}}function Se(){we++}function Te(){we--}function Ae(){var t;for(Te();!we&&void 0!==(t=be.shift());)xe(t)}var ke=function(t){return function(e){return t.some((function(t){return Re(t)(e)}))}},Pe=function(t){return function(e){return t(e)}},Ce=function(t){return function(e){return e.type===String(t)}},Me=function(t){return function(e){return e.type===t}},Le=function(){return Xt};function Re(t){var e="*"===t?Le:Nt(t)?Ce:It(t)?ke:zt(t)?Ce:Vt(t)?Pe:Ht(t)?Me:null;if(null===e)throw new Error("invalid pattern: "+t);return e(t)}var je={type:Ot},De=function(t){return t&&t.type===Ot};function Ke(t){void 0===t&&(t=he());var e=!1,n=[];return{take:function(r){e&&t.isEmpty()?r(je):t.isEmpty()?(n.push(r),r.cancel=function(){$t(n,r)}):r(t.take())},put:function(r){if(!e){if(0===n.length)return t.put(r);n.shift()(r)}},flush:function(n){e&&t.isEmpty()?n(je):n(t.flush())},close:function(){if(!e){e=!0;var t=n;n=[];for(var r=0,i=t.length;r<i;r++){(0,t[r])(je)}}}}}function Ve(){var t,e,n,r,i,o,s=(e=!1,r=n=[],i=function(){r===n&&(r=n.slice())},o=function(){e=!0;var t=n=r;r=[],t.forEach((function(t){t(je)}))},(t={})[At]=!0,t.put=function(t){if(!e)if(De(t))o();else for(var i=n=r,s=0,a=i.length;s<a;s++){var c=i[s];c[Tt](t)&&(c.cancel(),c(t))}},t.take=function(t,n){void 0===n&&(n=Le),e?t(je):(t[Tt]=n,i(),r.push(t),t.cancel=Jt((function(){i(),$t(r,t)})))},t.close=o,t),a=s.put;return s.put=function(t){t[kt]?a(t):Ee((function(){a(t)}))},s}function Ne(t,e){var n=t[Et];Vt(n)&&(e.cancel=n),t.then(e,(function(t){e(t,!0)}))}var Ie,Ue=0,Fe=function(){return++Ue};function We(t){t.isRunning()&&t.cancel()}var Ye=((Ie={}).TAKE=function(t,e,n){var r=e.channel,i=void 0===r?t.channel:r,o=e.pattern,s=e.maybe,a=function(t){t instanceof Error?n(t,!0):!De(t)||s?n(t):n(Lt)};try{i.take(a,Kt(o)?Re(o):null)}catch(t){return void n(t,!0)}n.cancel=a.cancel},Ie.PUT=function(t,e,n){var r=e.channel,i=e.action,o=e.resolve;Ee((function(){var e;try{e=(r?r.put:t.dispatch)(i)}catch(t){return void n(t,!0)}o&&Ut(e)?Ne(e,n):n(e)}))},Ie.ALL=function(t,e,n,r){var i=r.digestEffect,o=Ue,s=Object.keys(e);if(0!==s.length){var a=ae(e,n);s.forEach((function(t){i(e[t],o,a[t],t)}))}else n(It(e)?[]:{})},Ie.RACE=function(t,e,n,r){var i=r.digestEffect,o=Ue,s=Object.keys(e),a=It(e)?ne(s.length):{},c={},l=!1;s.forEach((function(t){var e=function(e,r){l||(r||se(e)?(n.cancel(),n(e,r)):(n.cancel(),l=!0,a[t]=e,n(a)))};e.cancel=Gt,c[t]=e})),n.cancel=function(){l||(l=!0,s.forEach((function(t){return c[t].cancel()})))},s.forEach((function(t){l||i(e[t],o,c[t],t)}))},Ie.CALL=function(t,e,n,r){var i=e.context,o=e.fn,s=e.args,a=r.task;try{var c=o.apply(i,s);if(Ut(c))return void Ne(c,n);if(Ft(c))return void Je(t,c,a.context,Ue,ce(o),!1,n);n(c)}catch(t){n(t,!0)}},Ie.CPS=function(t,e,n){var r=e.context,i=e.fn,o=e.args;try{var s=function(t,e){Dt(t)?n(e):n(t,!0)};i.apply(r,o.concat(s)),s.cancel&&(n.cancel=s.cancel)}catch(t){n(t,!0)}},Ie.FORK=function(t,e,n,r){var i=e.context,o=e.fn,s=e.args,a=e.detached,c=r.task,l=function(t){var e=t.context,n=t.fn,r=t.args;try{var i=n.apply(e,r);if(Ft(i))return i;var o=!1;return te((function(t){return o?{value:t,done:!0}:(o=!0,{value:i,done:!Ut(i)})}))}catch(t){return te((function(){throw t}))}}({context:i,fn:o,args:s}),u=function(t,e){return t.isSagaIterator?{name:t.meta.name}:ce(e)}(l,o);Oe((function(){var e=Je(t,l,c.context,Ue,u,a,void 0);a?n(e):e.isRunning()?(c.queue.addTask(e),n(e)):e.isAborted()?c.queue.abort(e.error()):n(e)}))},Ie.JOIN=function(t,e,n,r){var i=r.task,o=function(t,e){if(t.isRunning()){var n={task:i,cb:e};e.cancel=function(){t.isRunning()&&$t(t.joiners,n)},t.joiners.push(n)}else t.isAborted()?e(t.error(),!0):e(t.result())};if(It(e)){if(0===e.length)return void n([]);var s=ae(e,n);e.forEach((function(t,e){o(t,s[e])}))}else o(e,n)},Ie.CANCEL=function(t,e,n,r){var i=r.task;e===Pt?We(i):It(e)?e.forEach(We):We(e),n()},Ie.SELECT=function(t,e,n){var r=e.selector,i=e.args;try{n(r.apply(void 0,[t.getState()].concat(i)))}catch(t){n(t,!0)}},Ie.ACTION_CHANNEL=function(t,e,n){var r=e.pattern,i=Ke(e.buffer),o=Re(r),s=function e(n){De(n)||t.channel.take(e,o),i.put(n)},a=i.close;i.close=function(){s.cancel(),a()},t.channel.take(s,o),n(i)},Ie.CANCELLED=function(t,e,n,r){n(r.task.isCancelled())},Ie.FLUSH=function(t,e,n){e.flush(n)},Ie.GET_CONTEXT=function(t,e,n,r){n(r.task.context[e])},Ie.SET_CONTEXT=function(t,e,n,r){var i=r.task;Bt(i.context,e),n()},Ie);function ze(t,e){return t+"?"+e}function He(t){var e=t.name,n=t.location;return n?e+"  "+ze(n.fileName,n.lineNumber):e}var Xe=null,Ge=[],qe=function(){Xe=null,Ge.length=0},Be=function(){var t,e,n,r,i,o,s,a=Ge[0],c=Ge.slice(1),l=a.crashedEffect?(t=a.crashedEffect,(e=le(t))?e.code+"  "+ze(e.fileName,e.lineNumber):""):null;return["The above error occurred in task "+He(a.meta)+(l?" \n when executing effect "+l:"")].concat(c.map((function(t){return"    created by "+He(t.meta)})),[(n=Ge,r=function(t){return t.cancelledTasks},i=n,s=(o=[]).concat.apply(o,i.map(r)),s.length?["Tasks cancelled due to error:"].concat(s).join("\n"):"")]).join("\n")};function $e(t,e,n,r,i,o,s){var a;void 0===s&&(s=Gt);var c,l,u=0,h=null,f=[],p=Object.create(n),d=function(t,e,n){var r,i=[],o=!1;function s(t){e(),c(),n(t,!0)}function a(e){i.push(e),e.cont=function(a,c){o||($t(i,e),e.cont=Gt,c?s(a):(e===t&&(r=a),i.length||(o=!0,n(r))))}}function c(){o||(o=!0,i.forEach((function(t){t.cont=Gt,t.cancel()})),i=[])}return a(t),{addTask:a,cancelAll:c,abort:s,getTasks:function(){return i}}}(e,(function(){f.push.apply(f,d.getTasks().map((function(t){return t.meta.name})))}),_);function _(e,n){if(n){if(u=2,(o={meta:i,cancelledTasks:f}).crashedEffect=Xe,Ge.push(o),g.isRoot){var r=Be();qe(),t.onError(e,{sagaStack:r})}l=e,h&&h.reject(e)}else e===Mt?u=1:1!==u&&(u=3),c=e,h&&h.resolve(e);var o;g.cont(e,n),g.joiners.forEach((function(t){t.cb(e,n)})),g.joiners=null}var g=((a={})[Ct]=!0,a.id=r,a.meta=i,a.isRoot=o,a.context=p,a.joiners=[],a.queue=d,a.cancel=function(){0===u&&(u=1,d.cancelAll(),_(Mt,!1))},a.cont=s,a.end=_,a.setContext=function(t){Bt(p,t)},a.toPromise=function(){return h||(h=ye(),2===u?h.reject(l):0!==u&&h.resolve(c)),h.promise},a.isRunning=function(){return 0===u},a.isCancelled=function(){return 1===u||0===u&&1===e.status},a.isAborted=function(){return 2===u},a.result=function(){return c},a.error=function(){return l},a);return g}function Je(t,e,n,r,i,o,s){var a=t.finalizeRunEffect((function(e,n,r){if(Ut(e))Ne(e,r);else if(Ft(e))Je(t,e,l.context,n,i,!1,r);else if(e&&e[St]){(0,Ye[e.type])(t,e.payload,r,u)}else r(e)}));h.cancel=Gt;var c={meta:i,cancel:function(){0===c.status&&(c.status=1,h(Mt))},status:0},l=$e(t,c,n,r,i,o,s),u={task:l,digestEffect:f};return s&&(s.cancel=l.cancel),h(),l;function h(t,n){try{var i;n?(i=e.throw(t),qe()):oe(t)?(c.status=1,h.cancel(),i=Vt(e.return)?e.return(Mt):{done:!0,value:Mt}):i=ie(t)?Vt(e.return)?e.return():{done:!0}:e.next(t),i.done?(1!==c.status&&(c.status=3),c.cont(i.value)):f(i.value,r,h)}catch(t){if(1===c.status)throw t;c.status=2,c.cont(t,!0)}}function f(e,n,r,i){void 0===i&&(i="");var o,s=Fe();function c(n,i){o||(o=!0,r.cancel=Gt,t.sagaMonitor&&(i?t.sagaMonitor.effectRejected(s,n):t.sagaMonitor.effectResolved(s,n)),i&&function(t){Xe=t}(e),r(n,i))}t.sagaMonitor&&t.sagaMonitor.effectTriggered({effectId:s,parentEffectId:n,label:i,effect:e}),c.cancel=Gt,r.cancel=function(){o||(o=!0,c.cancel(),c.cancel=Gt,t.sagaMonitor&&t.sagaMonitor.effectCancelled(s))},a(e,s,c)}}function Qe(t,e){var n=t.channel,r=void 0===n?Ve():n,i=t.dispatch,o=t.getState,s=t.context,a=void 0===s?{}:s,c=t.sagaMonitor,l=t.effectMiddlewares,u=t.onError,h=void 0===u?ee:u;for(var f=arguments.length,p=new Array(f>2?f-2:0),d=2;d<f;d++)p[d-2]=arguments[d];var _=e.apply(void 0,p);var g,m=Fe();if(c&&(c.rootSagaStarted=c.rootSagaStarted||Gt,c.effectTriggered=c.effectTriggered||Gt,c.effectResolved=c.effectResolved||Gt,c.effectRejected=c.effectRejected||Gt,c.effectCancelled=c.effectCancelled||Gt,c.actionDispatched=c.actionDispatched||Gt,c.rootSagaStarted({effectId:m,saga:e,args:p})),l){var v=bt.apply(void 0,l);g=function(t){return function(e,n,r){return v((function(e){return t(e,n,r)}))(e)}}}else g=qt;var y={channel:r,dispatch:re(i),getState:o,sagaMonitor:c,onError:h,finalizeRunEffect:g};return Oe((function(){var t=Je(y,_,a,m,ce(e),!0,void 0);return c&&c.effectResolved(m,t),t}))}var Ze=function(t){var e,n=void 0===t?{}:t,r=n.context,i=void 0===r?{}:r,o=n.channel,s=void 0===o?Ve():o,a=n.sagaMonitor,c=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(n,["context","channel","sagaMonitor"]);function l(t){var n=t.getState,r=t.dispatch;return e=Qe.bind(null,jt({},c,{context:i,channel:s,dispatch:r,getState:n,sagaMonitor:a})),function(t){return function(e){a&&a.actionDispatched&&a.actionDispatched(e);var n=t(e);return s.put(e),n}}}return l.run=function(){return e.apply(void 0,arguments)},l.setContext=function(t){Bt(i,t)},l},tn=n(5),en=n.n(tn),nn=n(8),rn=n.n(nn),on=function(t){return{done:!0,value:t}},sn={};function an(t){return Yt(t)?"channel":zt(t)?String(t):Vt(t)?t.name:String(t)}function cn(t,e,n){var r,i,o,s=e;function a(e,n){if(s===sn)return on(e);if(n&&!i)throw s=sn,n;r&&r(e);var a=n?t[i](n):t[s]();return s=a.nextState,o=a.effect,r=a.stateUpdater,i=a.errorState,s===sn?on(e):o}return te(a,(function(t){return a(null,t)}),n)}function ln(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o,s={done:!1,value:pe(t)},a=function(t){return{done:!1,value:ge.apply(void 0,[e].concat(r,[t]))}},c=function(t){return o=t};return cn({q1:function(){return{nextState:"q2",effect:s,stateUpdater:c}},q2:function(){return{nextState:"q1",effect:a(o)}}},"q1","takeEvery("+an(t)+", "+e.name+")")}function un(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return ge.apply(void 0,[ln,t,e].concat(r))}var hn,fn=function(){return document.querySelector(".main__log")},pn=function(t){return"object"===rn()(t)?JSON.stringify(t,void 0,2):t.toLowerCase()},dn=function(t){var e=fn(),n=function(t){var e=document.createElement("div");e.classList.add("main__log-row");var n=document.createElement("span");return n.classList.add("main__log-row-msg"),n.innerHTML=t,e.appendChild(n),e}(t);e.appendChild(n),e.scrollTop=e.scrollHeight},_n=function(t){var e=fn(),n=e.children[e.childElementCount-1],r=n.children[1];if(r){var i=parseInt(r.textContent.match(/\s\((\d+)x\)/)[1],10);r.innerHTML=" (".concat(i+1,"x)")}else(r=document.createElement("span")).innerHTML=" (2x)",n.appendChild(r);e.scrollTop=e.scrollHeight},gn=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return requestAnimationFrame((function(){var t=fn();e.map(pn).forEach((function(e){var n=t.children[t.childElementCount-1];n&&e.toLowerCase()===n.children[0].textContent?_n():dn(e)}))}))},mn=n(21),vn=n.n(mn),yn=function(){return"_".concat(Math.random().toString(36).substr(2,9))},bn="FLOOR",wn="WALL",xn="DOOR_OPEN",En="DOOR_CLOSED",On="PORTAL",Sn="DOORWAY",Tn="PORTAL",An="DOOR",kn="DOORWAY",Pn={PORTAL:{char:"~",fg:"#a0a"},DOORWAY:{char:".",fg:"#aaa"}},Cn=(hn={},s()(hn,bn,{char:".",fg:"#aaa",bg:"#000",solid:!1}),s()(hn,wn,{char:"#",fg:"#fff",bg:"#000",solid:!0}),s()(hn,xn,{char:"'",fg:"#aaa",bg:"#000",solid:!1}),s()(hn,En,{char:"+",fg:"#aaa",bg:"#000",solid:!0}),s()(hn,On,{char:"~",fg:"#faf",bg:"#000",solid:!1}),s()(hn,Sn,{char:".",fg:"#aaa",bg:"#000",solid:!1}),hn),Mn=[{from:[12,10],to:[12,10],dir:[-1,0],type:An},{from:[12,10],to:[12,10],dir:[0,1],type:An},{from:[4,10],to:[4,10],dir:[1,0],type:An},{from:[4,10],to:[4,10],dir:[-1,0],type:An},{from:[10,20],to:[10,25],dir:[0,1],type:An},{from:[10,25],to:[10,20],dir:[0,-1],type:An},{from:[1,-1],to:[1,-1],dir:[0,1],type:kn},{from:[1,1],to:[1,-1],dir:[0,-1],type:Tn,hidden:!0,char:".",fg:"#aaa",triggerMsg:"you found a secret area!"},{from:[19,1],to:[10,31],dir:[1,0],type:Tn},{from:[5,36],to:[15,36],dir:[-1,0],type:Tn},{from:[15,36],to:[5,36],dir:[1,0],type:Tn},{from:[9,10],to:[100,100],dir:[-1,0],type:Tn,triggerMsg:"you have returned to the void. game over!"}];function Ln(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Rn=function(t,e,n,r,i){for(var o=t.canvas,s=t.getImageData(0,0,o.width,o.height),a=s.data,c=n%4;c<a.length;c+=4)a[c]=a[c+4*e];t.putImageData(s,0,0)},jn=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=t.getContainer(),i=r.getContext("2d");Rn(i,e,n)},Dn=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},o=!0,s=setTimeout((function(){o=!1,requestAnimationFrame(i)}),r);function a(){jn(t,e,n),o&&requestAnimationFrame(a)}return requestAnimationFrame(a),s},Kn=function(t){var e=Pr.getState(),n=e.items,r=e.map,i=e.lightingMap,o=e.explorationMap,a=e.mapOffset;Object.values(r).forEach((function(r){var c=r.x,l=r.y,u=r.type,h=r.contents,f=Cn[u],p=(f.char,f.fg,f.bg),d="".concat(c,"_").concat(l),_=d in i?i[d]:o.includes(d)?.25:0,g=e.portals.filter((function(t){return"PORTAL"===t.type&&t.from[0]===c&&t.from[1]===l})),m=h&&h.length>0&&n[h[0]],v=g&&g.length>0&&function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ln(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ln(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Pn[g[0].type],{},g[0]),y=d in i&&(m||v)||Cn[u],b=y.char,w=y.fg,x=ht.toHex(ht.interpolate(ht.fromString(p),"."===b?ht.multiply(ht.fromString(w),[128,128,128]):ht.fromString(w),_)),E=a[0]*-Nr,O=a[1]*-Ir;t.draw(c+E,l+O,b,x,p)}))},Vn=function(t){var e=Pr.getState(),n=e.player,r=e.mapOffset,i=n.x,o=n.y,s=r[0]*-Nr,a=r[1]*-Ir;t.draw(i+s,o+a,"@","#fff","#000")},Nn=function(t){var e=Pr.getState().openUIPanel;"INVENTORY"===e?function(t){var e=Pr.getState(),n=e.inventory,r=e.items;t.drawText(1,1,"you are carrying:");0===n.length?t.drawText(2,3,"- nothing"):n.map((function(t){return r[t]})).forEach((function(e,n){t.drawText(2,3+n,"- ".concat(e.name))}))}(t):"INVENTORY.DROP"===e?function(t){var e=Pr.getState(),n=e.inventory,r=e.items;t.drawText(1,1,"drop what exactly?");var i=["a","s","d","f","g","h","j","k","l"];n.map((function(t){return r[t]})).forEach((function(e,n){t.drawText(2,3+n,"".concat(i[n],") ").concat(e.name))}))}(t):"HELP"===e&&function(t){t.drawText(1,1,"keys:"),t.drawText(1,3,"move - wasd / hjkl / arrows"),t.drawText(1,6,"get - g"),t.drawText(1,7,"inventory - i"),t.drawText(3,8,"drop - d"),t.drawText(1,10,"open door - o"),t.drawText(1,11,"close door - c"),t.drawText(1,12,"unlock door - u"),t.drawText(1,19,"Find your way out!")}(t)},In=vn()((function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0;display.clear();var n=Pr.getState();if(n.openUIPanel)Nn(display);else if(Kn(display),Vn(display),t){var r=Math.max(0,1-Math.floor(5*Math.random())),i=Math.max(0,1-Math.floor(5*Math.random())),o=e||{},s=o.intensity,a=o.phase,c=o.duration;requestAnimationFrame((function(){return Dn(display,s||r,c||16,a||i,(function(){return In(!1)}))}))}}),16);function Un(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Fn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Un(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Un(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Wn=c.a.mark(nr),Yn=c.a.mark(rr),zn=c.a.mark(ir),Hn=c.a.mark(sr),Xn=c.a.mark(ar),Gn=c.a.mark(cr),qn=c.a.mark(lr),Bn=c.a.mark(hr),$n=c.a.mark(fr),Jn=c.a.mark(pr),Qn=c.a.mark(dr),Zn=c.a.mark(_r),tr=c.a.mark(gr),er=void 0;function nr(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==rn()(t.message)||void 0===t.message.length){e.next=5;break}return e.next=3,gn.apply(void 0,en()(t.message));case 3:e.next=7;break;case 5:return e.next=7,gn(t.message);case 7:case"end":return e.stop()}}),Wn)}function rr(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,void(fn().innerHTML="");case 2:case"end":return t.stop()}}),Yn)}function ir(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,un("LOG_MESSAGE",nr);case 2:return t.next=4,un("CLEAR_LOG",rr);case 4:case"end":return t.stop()}}),zn)}var or=function(t){return function(e,n){var r=t["".concat(e,"_").concat(n)];return r&&!Cn[r.type].solid}};function sr(t){var e,n,r,i,o;return c.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return e=["UPDATE_CELL","UPDATE_CELLS"].includes(t.type),s.next=3,me();case 3:if(n=s.sent,r=n.player,i=n.map,r){s.next=8;break}return s.abrupt("return");case 8:return er&&!e||(er=new G.RecursiveShadowcasting(or(i))),o={},er.compute(r.x,r.y,4,(function(t,e,n,r){o["".concat(t,"_").concat(e)]=r})),s.next=13,de({type:"UPDATE_LIGHTING_MAP",map:o});case 13:return s.next=15,de({type:"UPDATE_EXPLORATION_MAP",map:Object.keys(o)});case 15:case"end":return s.stop()}}),Hn)}function ar(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,un("MOVE_PLAYER",sr);case 2:return t.next=4,un("CALCULATE_FOV",sr);case 4:return t.next=6,un("UPDATE_CELL",sr);case 6:return t.next=8,un("UPDATE_CELLS",sr);case 8:case"end":return t.stop()}}),Xn)}function cr(t){var e;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=t.options||{phase:1,intensity:1,duration:60},n.next=3,In(!0,e);case 3:case"end":return n.stop()}}),Gn)}function lr(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,un("PULSE",cr);case 2:case"end":return t.stop()}}),qn)}var ur=function(t,e){var n=t.player,r=t.map,i=n.x,o=n.y,s=["".concat(i+1,"_").concat(o),"".concat(i-1,"_").concat(o),"".concat(i,"_").concat(o+1),"".concat(i,"_").concat(o-1)].map((function(t){return r[t]})).filter((function(t){return!!t}));return e?s.filter((function(t){return t.type===e})):s};function hr(){var t,e,n,r,i;return c.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,me();case 2:return t=o.sent,e=t.portals,o.next=6,ur(t,En);case 6:if(n=o.sent,r=n.filter((function(t){return e.filter((function(e){return e.from[0]===t.x&&e.from[1]===t.y&&void 0!==e.locked&&!!e.locked})).length>0})),0!==n.length){o.next=13;break}return o.next=11,de({type:"LOG_MESSAGE",message:"Nothing to open."});case 11:o.next=24;break;case 13:if(!(r.length>0)){o.next=18;break}return o.next=16,de({type:"LOG_MESSAGE",message:"The door is locked."});case 16:o.next=24;break;case 18:return(i=n.map((function(t){return Fn({},t,{type:xn})}))).forEach((function(e){var n=t.portals.filter((function(t){return t.from[0]===e.x&&t.from[1]===e.y})).map((function(e){return t.map[e.to.join("_")]})).map((function(t){return Fn({},t,{type:xn})}));i.push.apply(i,en()(n))})),o.next=22,de({type:"LOG_MESSAGE",message:"You open the door".concat(n.length>1?"s":"",".")});case 22:return o.next=24,de({type:"UPDATE_CELLS",cells:i});case 24:case"end":return o.stop()}}),Bn)}function fr(){var t,e,n;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,me();case 2:return t=r.sent,r.next=5,ur(t,xn);case 5:if(0!==(e=r.sent).length){r.next=11;break}return r.next=9,de({type:"LOG_MESSAGE",message:"Nothing to close."});case 9:r.next=17;break;case 11:return(n=e.map((function(t){return Fn({},t,{type:En})}))).forEach((function(e){var r=t.portals.filter((function(t){return t.from[0]===e.x&&t.from[1]===e.y})).map((function(e){return t.map[e.to.join("_")]})).map((function(t){return Fn({},t,{type:En})}));n.push.apply(n,en()(r))})),r.next=15,de({type:"LOG_MESSAGE",message:"You close the door".concat(e.length>1?"s":"",".")});case 15:return r.next=17,de({type:"UPDATE_CELLS",cells:n});case 17:case"end":return r.stop()}}),$n)}function pr(){var t,e,n,r,i,o,s,a,l;return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,me();case 2:return t=c.sent,e=t.items,n=t.inventory,r=t.portals,c.next=6,ur(t,En);case 6:if(i=c.sent,o=i.filter((function(t){return r.filter((function(e){return e.from[0]===t.x&&e.from[1]===t.y})).filter((function(t){return void 0!==t.locked&&!!t.locked})).length>0})),!((s=o.map((function(t){var e=r.filter((function(e){return e.from[0]===t.x&&e.from[1]===t.y}));return Fn({},t,{key:e[0].key})})).filter((function(t){return n.includes(t.key)}))).length>0)){c.next=18;break}return a=r.map((function(t){return void 0!==t.key&&t.key===s[0].key?Fn({},t,{locked:!1}):t})),l=e[s[0].key].name,c.next=14,de({type:"UPDATE_PORTALS",portals:a});case 14:return c.next=16,de({type:"LOG_MESSAGE",message:"You unlock the door with ".concat(l,".")});case 16:c.next=25;break;case 18:if(!(o.length>0)){c.next=23;break}return c.next=21,de({type:"LOG_MESSAGE",message:"You don't have the key."});case 21:c.next=25;break;case 23:return c.next=25,de({type:"LOG_MESSAGE",message:"Nothing here to unlock."});case 25:case"end":return c.stop()}}),Jn)}function dr(){var t,e,n,r,i,o,s;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,me();case 2:if(t=a.sent,e=t.map,n=t.player,r=t.items,(i=e["".concat(n.x,"_").concat(n.y)]).contents&&0!==i.contents.length){a.next=10;break}return a.next=8,de({type:"LOG_MESSAGE",message:"There is nothing here to get."});case 8:a.next=18;break;case 10:return o=i.contents[0],s=r[i.contents[0]],a.next=14,de({type:"UPDATE_CELL",cell:Fn({},i,{contents:i.contents.filter((function(t){return t!==o}))})});case 14:return a.next=16,de({type:"PICK_UP_ITEM",item:o});case 16:return a.next=18,de({type:"LOG_MESSAGE",message:"You pick up ".concat(s.name,".")});case 18:case"end":return a.stop()}}),Qn)}function _r(t){var e,n,r,i,o,s,a;return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,me();case 2:if(e=c.sent,n=e.map,r=e.player,i=e.items,o=e.inventory,!(s=o[t.idx])){c.next=13;break}return a=n["".concat(r.x,"_").concat(r.y)],c.next=9,de({type:"DROP_ITEM",item:s});case 9:return c.next=11,de({type:"UPDATE_CELL",cell:Fn({},a,{contents:a.contents&&a.contents.length>0?[].concat(en()(a.contents),[s]):[s]})});case 11:return c.next=13,de({type:"LOG_MESSAGE",message:"You drop ".concat(i[s].name,".")});case 13:case"end":return c.stop()}}),Zn)}function gr(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,un("COMMAND_CLOSE",fr);case 2:return t.next=4,un("COMMAND_OPEN",hr);case 4:return t.next=6,un("COMMAND_UNLOCK",pr);case 6:return t.next=8,un("COMMAND_GET",dr);case 8:return t.next=10,un("COMMAND_DROP",_r);case 10:case"end":return t.stop()}}),tr)}var mr=n(10),vr=n.n(mr);function yr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function br(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yr(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var wr={map:{},lightingMap:{},explorationMap:[],mapOffset:[0,0],player:void 0,portals:[],openUIPanel:void 0,inventory:[],items:{}},xr=function(t,e){var n=e.cell,r=e.x||n.x,i=e.y||n.y,o="".concat(r,"_").concat(i),a=t.map[o]||{};return br({},t,{map:br({},t.map,s()({},o,br({},a,{},n)))})},Er=function(t,e){return br({},t,{items:br({},t.items,s()({},e.item.id,e.item))})},Or={MOVE_PLAYER:function(t,e){var n=e.dx,r=e.dy,i=t.items,o=(t.mapOffset,t.player),s=t.map,a=t.portals,c=o.x,l=o.y,u="".concat(c+n,"_").concat(l+r),h=o.x+n,f=o.y+r,p=s[u],d=a.filter((function(t){return t.from[0]===o.x&&t.from[1]===o.y})),_=(a.forEach((function(t){if(t.from[0]===h&&t.from[1]===f&&"PORTAL"===t.type&&!0!==t.hidden){var e=function(t){var e=vr()(t,2),n=e[0],r=e[1];return 0===n&&1===r?"south":0===n&&-1===r?"north":1===n&&0===r?"east":-1===n&&0===r?"west":""}(t.dir);requestAnimationFrame((function(){return game.log("There is something strange to the ".concat(e,"."))}))}})),d.filter((function(t){return t.from[0]===o.x&&t.from[1]===o.y&&t.dir[0]===n&&t.dir[1]===r})));if(_&&_.length>0){var g=_[0],m=g.to,v=(g.from,g.dir),y=g.type,b=vr()(m,2);h=b[0],f=b[1],["DOOR","DOORWAY"].includes(y)&&(h+=v[0],f+=v[1]),"PORTAL"===_[0].type&&requestAnimationFrame((function(){game.dispatch({type:"PULSE",options:{intensity:20,phase:50,duration:420}}),game.log("You step through the portal."),_[0].triggerMsg&&!_[0].triggered&&(game.log(_[0].triggerMsg),requestAnimationFrame((function(){return game.dispatch({type:"UPDATE_PORTAL",portal:br({},_[0],{triggered:!0})})})))}))}else if(p&&Cn[p.type].solid){requestAnimationFrame((function(){return game.log("Alas! You cannot go that way.")}));var w=[o.x,o.y];h=w[0],f=w[1]}var x=[Math.floor(h/21),Math.floor(f/21)];if(p&&p.contents&&p.contents.length>0){var E=p.contents.map((function(t){return i[t]}));requestAnimationFrame((function(){var t;return(t=game).log.apply(t,en()(E.map((function(t){return"There is ".concat(t.name," here.")}))))}))}return br({},t,{player:br({},o,{x:h,y:f}),mapOffset:x})},UPDATE_CELL:xr,UPDATE_CELLS:function(t,e){return e.cells.map((function(t){return{x:t.x,y:t.y,cell:t}})).reduce(xr,t)},UPDATE_LIGHTING_MAP:function(t,e){return br({},t,{lightingMap:e.map})},UPDATE_EXPLORATION_MAP:function(t,e){e.map;return br({},t,{explorationMap:en()(new Set([].concat(en()(t.explorationMap),en()(e.map))))})},UPDATE_MAP_OFFSET:function(t,e){return br({},t,{mapOffset:[t.mapOffset[0]+dx,t.mapOffset[1]+dy]})},UPDATE_PORTALS:function(t,e){return br({},t,{portals:e.portals.map((function(t){return t.id?t:br({},t,{id:yn()})}))})},UPDATE_PORTAL:function(t,e){return br({},t,{portals:t.portals.map((function(t){return t.id===e.portal.id?e.portal:t}))})},SET_PLAYER_POSITION:function(t,e){var n=e.position,r=vr()(n,2),i=r[0],o=r[1],s=[Math.floor(i/21),Math.floor(o/21)];return br({},t,{player:br({},t.player,{x:e.position[0],y:e.position[1]}),mapOffset:s})},OPEN_UI_PANEL:function(t,e){return br({},t,{openUIPanel:e.panel})},CLOSE_UI_PANEL:function(t,e){return br({},t,{openUIPanel:void 0})},ADD_ITEMS:function(t,e){return e.items.map((function(t){return{item:t}})).reduce(Er,t)},ADD_ITEM:Er,PICK_UP_ITEM:function(t,e){return br({},t,{inventory:t.inventory.concat([e.item])})},DROP_ITEM:function(t,e){return br({},t,{inventory:t.inventory.filter((function(t){return t!==e.item}))})}},Sr=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wr,e=arguments.length>1?arguments[1]:void 0;return Or[e.type]?Or[e.type](t,e):t},Tr=Ze(),Ar=[Tr];Ar.push(Object(wt.createLogger)({collapsed:!0}));var kr=function t(e,n,r){var i;if("function"==typeof n&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof n&&void 0===r&&(r=n,n=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(t)(e,n)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,s=n,a=[],c=a,l=!1;function u(){c===a&&(c=a.slice())}function h(){if(l)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return s}function f(t){if("function"!=typeof t)throw new Error("Expected the listener to be a function.");if(l)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var e=!0;return u(),c.push(t),function(){if(e){if(l)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");e=!1,u();var n=c.indexOf(t);c.splice(n,1),a=null}}}function p(t){if(!gt(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(l)throw new Error("Reducers may not dispatch actions.");try{l=!0,s=o(s,t)}finally{l=!1}for(var e=a=c,n=0;n<e.length;n++){(0,e[n])()}return t}function d(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");o=t,p({type:_t.REPLACE})}function _(){var t,e=f;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");function n(){t.next&&t.next(h())}return n(),{unsubscribe:e(n)}}})[pt.a]=function(){return this},t}return p({type:_t.INIT}),(i={dispatch:p,subscribe:f,getState:h,replaceReducer:d})[pt.a]=_,i}(Sr,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(){var n=t.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},i={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},o=e.map((function(t){return t(i)}));return yt({},n,{dispatch:r=bt.apply(void 0,o)(n.dispatch)})}}}.apply(void 0,Ar));kr.log=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];kr.dispatch({type:"LOG_MESSAGE",message:e})},kr.clearLog=function(){return kr.dispatch({type:"CLEAR_LOG"})},Tr.run(ir),Tr.run(ar),Tr.run(lr),Tr.run(gr);var Pr=kr,Cr=n(3),Mr=n.n(Cr);function Lr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Rr="KEY",jr=s()({},Rr,{name:"a key",char:"F",usable:!0,unique:!0,fg:"#aa0"}),Dr=function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lr(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({id:yn(),type:t},jr[t])};function Kr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Vr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Kr(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Kr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Nr=21,Ir=21,Ur=new U({width:Nr,height:Ir,forceSquareRatio:!0});Ur.setOptions({fontFamily:"Major Mono Display",fontStyle:"bold"});var Fr=function(){var t=u()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){document.querySelector(".main__canvas").appendChild(Ur.getContainer()),t()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Wr=[Dr(Rr)];Pr.dispatch({type:"ADD_ITEMS",items:Wr});var Yr,zr=Wr[0].id,Hr=Mn.map((function(t,e){return e>1?t:Vr({},t,{key:zr,locked:!0})})),Xr=(Yr=Hr,[{x:0,y:0,width:21,height:21},{x:4,y:4,width:13,height:13},{x:8,y:8,width:5,height:5},{x:4,y:25,width:13,height:13},{x:0,y:-5,width:5,height:5}].reduce((function(t,e){var n=function(t,e){for(var n=[],r=t.x,i=t.y,o=t.width,s=t.height,a=(t.doors,t.color,t.backgroundColor,t.floorColor,r+1);a<=r+o-2;a++)for(var c=i+1;c<=i+s-2;c++)n.push({x:a,y:c,type:bn});for(var l=r,u=i;l<=r+o-1;l++)n.push({x:l,y:u,type:wn});for(var h=r,f=i+s-1;h<=r+o-1;h++)n.push({x:h,y:f,type:wn});for(var p=r,d=i+1;d<=i+s-1;d++)n.push({x:p,y:d,type:wn});for(var _=r+o-1,g=i+1;g<=i+s-1;g++)n.push({x:_,y:g,type:wn});return e.filter((function(t){return"DOOR"===t.type})).forEach((function(t){n.push({x:t.from[0],y:t.from[1],type:!1===t.closed?xn:En})})),e.filter((function(t){return"DOORWAY"===t.type})).forEach((function(t){n.push({x:t.from[0],y:t.from[1],type:Sn})})),n}(e,Yr);return t.concat(n)}),[]));Pr.dispatch({type:"UPDATE_CELLS",cells:Xr});var Gr=Object.values(Pr.getState().map).filter((function(t){return!Cn[t.type].solid})),qr=h.a.getItem(Gr.filter((function(t){return t.x<5&&t.y<0})));Pr.dispatch({type:"UPDATE_CELL",cell:Vr({},qr,{contents:[zr]})}),Pr.dispatch({type:"UPDATE_PORTALS",portals:Hr});var Br=h.a.getItem(Gr);Pr.dispatch({type:"SET_PLAYER_POSITION",position:[Br.x,Br.y]}),Pr.dispatch({type:"CALCULATE_FOV"});var $r=function(){Pr.dispatch({type:"MOVE_PLAYER",dx:0,dy:-1})},Jr=function(){Pr.dispatch({type:"MOVE_PLAYER",dx:0,dy:1})},Qr=function(){Pr.dispatch({type:"MOVE_PLAYER",dx:-1,dy:0})},Zr=function(){Pr.dispatch({type:"MOVE_PLAYER",dx:1,dy:0})},ti=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Pr.dispatch({type:"OPEN_UI_PANEL",panel:t?"INVENTORY.DROP":"INVENTORY"})},ei=function(){var t=u()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Mr.a.setScope("default"),Mr()("default","o",(function(){return Pr.dispatch({type:"COMMAND_OPEN"})})),Mr()("default","c",(function(){return Pr.dispatch({type:"COMMAND_CLOSE"})})),Mr()("default","u",(function(){return Pr.dispatch({type:"COMMAND_UNLOCK"})})),Mr()("default","g",(function(){return Pr.dispatch({type:"COMMAND_GET"})})),["k","w","up"].forEach((function(t){return Mr()("default",t,$r)})),["j","s","down"].forEach((function(t){return Mr()("default",t,Jr)})),["h","a","left"].forEach((function(t){return Mr()("default",t,Qr)})),["l","d","right"].forEach((function(t){return Mr()("default",t,Zr)})),Mr()("default","i",(function(){Mr.a.setScope("inventory"),ti()})),Mr()("esc",(function(){Mr.a.setScope("default"),Pr.dispatch({type:"CLOSE_UI_PANEL"})})),Mr()("inventory","d",(function(){Pr.getState().inventory.length>0&&(ti(!0),Mr.a.setScope("inventory.drop"))})),Mr()("f1",(function(){Mr.a.setScope("help"),Pr.dispatch({type:"OPEN_UI_PANEL",panel:"HELP"})})),["a","s","d","f","g","h","j","k","l"].forEach((function(t,e){Mr()("inventory.drop",t,(function(){Mr.a.setScope("inventory"),ti(),Pr.dispatch({type:"COMMAND_DROP",idx:e})}))}));case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(function(){var t=u()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fr();case 2:ei(),requestAnimationFrame(In);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()(),Pr.subscribe((function(){return requestAnimationFrame(In)})),window.game=Pr,window.ROT=i,window.display=Ur}]);